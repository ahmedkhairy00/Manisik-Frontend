<form [formGroup]="form" (ngSubmit)="onSubmit()" class="flex flex-col h-full">

    <!-- Scrollable Container -->
    <div class="flex-1 overflow-y-auto max-h-[70vh] px-1 custom-scrollbar space-y-5">

        @for (field of config; track field.name) {
        <div class="flex flex-col gap-1.5">
            <label [for]="field.name" class="text-sm font-medium text-[var(--color-text)]">
                {{ field.label }}
                @if (field.validators?.required) { <span class="text-red-500">*</span> }
            </label>

            @switch (field.type) {
            @case ('select') {
            <select [formControlName]="field.name" [id]="field.name"
                class="w-full px-4 py-3 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 focus:border-[var(--primary)] outline-none transition-all duration-200"
                [class.border-red-500]="form.get(field.name)?.touched && form.get(field.name)?.invalid">
                <option value="" disabled selected>{{ field.placeholder || 'Select ' + field.label }}</option>
                @for (opt of field.options; track opt.value) {
                <option [value]="opt.value">{{ opt.label }}</option>
                }
            </select>
            }
            @case ('textarea') {
            <textarea [formControlName]="field.name" [id]="field.name" [placeholder]="field.placeholder || ''" rows="4"
                class="w-full px-4 py-3 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 focus:border-[var(--primary)] outline-none transition-all duration-200 resize-none"
                [class.border-red-500]="form.get(field.name)?.touched && form.get(field.name)?.invalid">
            </textarea>
            }
            @case ('checkbox') {
            <div class="flex items-center gap-3 py-2">
                <input type="checkbox" [formControlName]="field.name" [id]="field.name"
                    class="w-5 h-5 rounded border-gray-300 text-[var(--primary)] focus:ring-[var(--primary)]">
                <span class="text-sm text-[var(--color-text)]">{{ field.placeholder || 'Yes' }}</span>
            </div>
            }
            @default {
            <input [type]="field.type" [formControlName]="field.name" [id]="field.name"
                [placeholder]="field.placeholder || ''"
                class="w-full px-4 py-3 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 focus:border-[var(--primary)] outline-none transition-all duration-200"
                [class.border-red-500]="form.get(field.name)?.touched && form.get(field.name)?.invalid">
            }
            }

            <!-- Inline Error Messages -->
            @if (form.get(field.name)?.touched && form.get(field.name)?.invalid) {
            <div class="text-red-500 text-xs font-medium mt-0.5 animate-fadeIn flex items-center gap-1">
                <lucide-icon name="alert-circle" class="w-4 h-4"></lucide-icon>
                {{ getErrorMessage(field) }}
            </div>
            }
        </div>
        }

    </div>

    <!-- Footer / Submit Button -->
    <div class="pt-6 mt-4 border-t border-[var(--border)]">
        <button type="submit" [disabled]="form.invalid || loading"
            class="w-full py-3.5 px-6 rounded-xl bg-[var(--primary)] text-white font-semibold shadow-lg shadow-[var(--primary)]/30 hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-all active:scale-[0.98] flex items-center justify-center gap-2">
            @if (loading) {
            <span class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
            }
            {{ submitLabel }}
        </button>
    </div>
</form>