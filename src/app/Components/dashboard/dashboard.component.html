<div class="min-h-screen bg-[var(--color-bg)]">
    <!-- Header -->
    <header class="sticky top-0 z-40 bg-[var(--color-surface)] border-b border-[var(--border)] shadow-sm">
        <div class="max-w-[1440px] mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 rounded-xl bg-gradient-to-br from-[var(--primary)] to-purple-600 flex items-center justify-center text-white text-xl shadow-lg">
                    üïã
                </div>
                <div class="flex flex-col">
                    <span class="text-lg font-semibold text-[var(--color-text)]">{{ i18n.t('dashboard.title') }}</span>
                    <span class="text-xs text-[var(--color-text-muted)]">{{ i18n.t('dashboard.subtitle.' + role())
                        }}</span>
                </div>
            </div>

            <!-- User dropdown / actions -->
            <div class="flex items-center gap-4 relative">
                <div class="hidden sm:flex sm:items-center sm:gap-3">
                    <span class="text-sm text-[var(--color-text-muted)]">{{ currentUserName() }}</span>
                </div>

                <div class="relative">
                    <button (click)="toggleUserMenu()" aria-haspopup="true" [attr.aria-expanded]="showUserMenu()"
                        class="flex items-center gap-3 px-3 py-1 rounded-xl hover:bg-[var(--color-bg)] focus:outline-none text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/30">
                        <div
                            class="w-10 h-10 rounded-full bg-gradient-to-br from-[var(--primary)] to-purple-600 flex items-center justify-center text-white font-bold">
                            {{ getUserInitials() }}</div>
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </button>

                    <!-- Dropdown -->
                    <div *ngIf="showUserMenu()"
                        class="absolute right-0 mt-2 w-72 bg-[var(--color-surface)] border border-[var(--border)] rounded-xl shadow-2xl p-3 z-50 dashboard-dropdown">
                        <div class="flex items-start gap-3 p-2 border-b border-[var(--border)]">
                            <div
                                class="w-12 h-12 rounded-full bg-[var(--color-surface)] flex items-center justify-center font-semibold text-lg text-[var(--color-text)]">
                                {{ getUserInitials() }}</div>
                            <div class="flex-1">
                                <div class="font-semibold text-[var(--color-text)]">{{ currentUserName() }}</div>
                                <div class="text-sm text-[var(--color-text-muted)]">{{ currentUserPhone() }}</div>
                            </div>
                        </div>
                        <div class="mt-2 space-y-2">
                            <button (click)="goToProfile()"
                                class="w-full text-left px-3 py-2 rounded hover:bg-[var(--color-bg)]">{{
                                i18n.t('profile.editProfile') }}</button>
                            <button (click)="logout()"
                                class="w-full text-left px-3 py-2 rounded hover:bg-[var(--color-bg)] text-red-600">{{
                                i18n.t('nav.logout') }}</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Backdrop to close dropdown when clicking outside -->
    <div *ngIf="showUserMenu()" class="fixed inset-0 z-40" (click)="closeUserMenu()"></div>

    <div class="max-w-[1440px] mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Sidebar -->
            <aside class="lg:col-span-3">
                <nav
                    class="bg-[var(--color-surface)] rounded-2xl p-4 border border-[var(--border)] shadow-sm space-y-2 sticky top-24">
                    <button (click)="setActiveView('overview')" [class.active]="activeView() === 'overview'"
                        class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-200"
                        [ngClass]="activeView() === 'overview' ? 'bg-[var(--primary)] text-white shadow-md' : 'hover:bg-[var(--color-bg)] text-[var(--color-text-muted)]'">
                        <span>üìä</span> {{ i18n.t('dashboard.menu.overview') }}
                    </button>
                    <button (click)="setActiveView('bookings')" [class.active]="activeView() === 'bookings'"
                        class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-200"
                        [ngClass]="activeView() === 'bookings' ? 'bg-[var(--primary)] text-white shadow-md' : 'hover:bg-[var(--color-bg)] text-[var(--color-text-muted)]'">
                        <span>üìã</span> {{ getBookingsMenuLabel() }}
                    </button>
                    <button *ngIf="role() === 'Admin'" (click)="setActiveView('users')"
                        [class.active]="activeView() === 'users'"
                        class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-200"
                        [ngClass]="activeView() === 'users' ? 'bg-[var(--primary)] text-white shadow-md' : 'hover:bg-[var(--color-bg)] text-[var(--color-text-muted)]'">
                        <span>üë•</span> {{ i18n.t('dashboard.menu.users') }}
                    </button>
                    <button *ngIf="role() === 'Admin' || role() === 'HotelManager'" (click)="setActiveView('hotels')"
                        [class.active]="activeView() === 'hotels'"
                        class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-200"
                        [ngClass]="activeView() === 'hotels' ? 'bg-[var(--primary)] text-white shadow-md' : 'hover:bg-[var(--color-bg)] text-[var(--color-text-muted)]'">
                        <span>üè®</span> {{ i18n.t('dashboard.menu.hotels') }}
                    </button>
                    <button *ngIf="role() === 'Admin'" (click)="setActiveView('international-transport')"
                        [class.active]="activeView() === 'international-transport'"
                        class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-200"
                        [ngClass]="activeView() === 'international-transport' ? 'bg-[var(--primary)] text-white shadow-md' : 'hover:bg-[var(--color-bg)] text-[var(--color-text-muted)]'">
                        <span>‚úàÔ∏è</span> {{ i18n.t('dashboard.menu.internationalTransport') }}
                    </button>
                    <button *ngIf="role() === 'Admin'" (click)="setActiveView('ground-transport')"
                        [class.active]="activeView() === 'ground-transport'"
                        class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-200"
                        [ngClass]="activeView() === 'ground-transport' ? 'bg-[var(--primary)] text-white shadow-md' : 'hover:bg-[var(--color-bg)] text-[var(--color-text-muted)]'">
                        <span>üöå</span> {{ i18n.t('dashboard.menu.groundTransport') }}
                    </button>
                </nav>
            </aside>

            <main class="lg:col-span-9">

                <!-- Overview -->
                <div *ngIf="activeView() === 'overview'" class="space-y-6 animate-fadeIn">
                    <div
                        class="bg-gradient-to-r from-[var(--primary)] to-purple-600 rounded-2xl p-8 text-white shadow-lg relative overflow-hidden">
                        <div
                            class="absolute top-0 right-0 w-64 h-64 bg-[var(--color-bg)]/10 rounded-full -mr-16 -mt-16 blur-3xl">
                        </div>
                        <div class="relative z-10">
                            <h2 class="text-3xl font-bold mb-2"><span> {{i18n.t('dashboard.welcome')}} </span>
                                {{currentUserName()}}
                                üëã
                            </h2>
                            <p class="text-white/90 text-lg">{{ getWelcomeMessage() }}</p>

                            <!-- Admin Actions -->
                            <div *ngIf="role() === 'Admin'" class="flex items-center gap-3 mt-6">
                                <button (click)="openBroadcastModal()"
                                    class="px-5 py-2.5 bg-white/20 hover:bg-white/30 text-white rounded-xl backdrop-blur-md transition-all font-medium flex items-center gap-2 border border-white/10">
                                    <lucide-icon name="mail" [size]="18"></lucide-icon>
                                    {{ i18n.t('dashboard.sendNewsletter') }}
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div
                            class="bg-[var(--color-surface)] rounded-2xl p-6 border border-[var(--border)] shadow-sm hover:shadow-md transition-shadow duration-200 group">
                            <div
                                class="w-12 h-12 rounded-xl bg-blue-50 text-blue-600 flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
                                üìä</div>
                            <div class="text-4xl font-bold mb-1 text-[var(--color-text)]">{{ stats().total }}</div>
                            <div class="text-sm text-[var(--color-text-muted)] font-medium">{{
                                i18n.t('dashboard.totalBookings') }}
                            </div>
                        </div>
                        <div
                            class="bg-[var(--color-surface)] rounded-2xl p-6 border border-[var(--border)] shadow-sm hover:shadow-md transition-shadow duration-200 group">
                            <div
                                class="w-12 h-12 rounded-xl bg-green-50 text-green-600 flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
                                ‚úÖ</div>
                            <div class="text-4xl font-bold mb-1 text-[var(--color-text)]">{{ stats().confirmed }}</div>
                            <div class="text-sm text-[var(--color-text-muted)] font-medium">{{
                                i18n.t('dashboard.status') }}:
                                {{ i18n.t('dashboard.confirmed') }}
                            </div>
                        </div>
                        <div
                            class="bg-[var(--color-surface)] rounded-2xl p-6 border border-[var(--border)] shadow-sm hover:shadow-md transition-shadow duration-200 group">
                            <div
                                class="w-12 h-12 rounded-xl bg-yellow-50 text-yellow-600 flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
                                ‚è≥</div>
                            <div class="text-4xl font-bold mb-1 text-[var(--color-text)]">{{ stats().pending }}</div>
                            <div class="text-sm text-[var(--color-text-muted)] font-medium">{{
                                i18n.t('dashboard.status') }}: {{
                                i18n.t('dashboard.pending') }}
                            </div>
                        </div>
                        <div
                            class="bg-[var(--color-surface)] rounded-2xl p-6 border border-[var(--border)] shadow-sm hover:shadow-md transition-shadow duration-200 group">
                            <div
                                class="w-12 h-12 rounded-xl bg-red-50 text-red-600 flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
                                {{ role() === 'Admin' ? 'üë•' : '‚ùå' }}</div>
                            <div class="text-4xl font-bold mb-1 text-[var(--color-text)]">{{ role() === 'Admin' ?
                                stats().users :
                                stats().cancelled }}</div>
                            <div class="text-sm text-[var(--color-text-muted)] font-medium">{{ role() === 'Admin' ?
                                i18n.t('dashboard.totalUsers') :
                                i18n.t('dashboard.cancelled') }}</div>
                        </div>
                    </div>

                    <!-- Admin-only Resource Stats -->
                    <div *ngIf="role() === 'Admin'" class="grid grid-cols-1 sm:grid-cols-3 gap-6 mt-6">
                        <div
                            class="bg-[var(--color-surface)] rounded-2xl p-6 border border-[var(--border)] shadow-sm hover:shadow-md transition-shadow duration-200 group">
                            <div
                                class="w-12 h-12 rounded-xl bg-purple-50 text-purple-600 flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
                                üè®</div>
                            <div class="text-4xl font-bold mb-1 text-[var(--color-text)]">{{ stats().hotels }}</div>
                            <div class="text-sm text-[var(--color-text-muted)] font-medium">{{
                                i18n.t('dashboard.totalHotels') }}
                            </div>
                        </div>
                        <div
                            class="bg-[var(--color-surface)] rounded-2xl p-6 border border-[var(--border)] shadow-sm hover:shadow-md transition-shadow duration-200 group">
                            <div
                                class="w-12 h-12 rounded-xl bg-sky-50 text-sky-600 flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
                                ‚úàÔ∏è</div>
                            <div class="text-4xl font-bold mb-1 text-[var(--color-text)]">{{
                                stats().internationalTransports }}</div>
                            <div class="text-sm text-[var(--color-text-muted)] font-medium">{{
                                i18n.t('dashboard.flights') }}</div>
                        </div>
                        <div
                            class="bg-[var(--color-surface)] rounded-2xl p-6 border border-[var(--border)] shadow-sm hover:shadow-md transition-shadow duration-200 group">
                            <div
                                class="w-12 h-12 rounded-xl bg-orange-50 text-orange-600 flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition-transform">
                                üöå</div>
                            <div class="text-4xl font-bold mb-1 text-[var(--color-text)]">{{ stats().groundTransports }}
                            </div>
                            <div class="text-sm text-[var(--color-text-muted)] font-medium">{{
                                i18n.t('dashboard.groundTransportLabel') }}</div>
                        </div>
                    </div>
                </div>

                <!-- Bookings -->
                <div *ngIf="activeView() === 'bookings'" class="space-y-6 animate-fadeIn">
                    <h2 class="text-2xl font-bold text-[var(--color-text)]">{{ getBookingsMenuLabel() }}</h2>
                    <div class="bg-[var(--color-surface)] rounded-2xl p-5 border border-[var(--border)] shadow-sm">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="bookingStatusFilter"
                                    class="block text-sm font-medium text-[var(--color-text-muted)] mb-1">{{
                                    i18n.t('dashboard.status')
                                    }}</label>
                                <select id="bookingStatusFilter" (change)="updateBookingStatusFilter($event)"
                                    class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none text-[var(--color-text)] transition-all">
                                    <option value="all" class="bg-[var(--color-bg)] text-[var(--color-text)]">All
                                    </option>
                                    <option value="Pending" class="bg-[var(--color-bg)] text-[var(--color-text)]">
                                        Pending</option>
                                    <option value="Confirmed" class="bg-[var(--color-bg)] text-[var(--color-text)]">
                                        Confirmed</option>
                                    <option value="Paid" class="bg-[var(--color-bg)] text-[var(--color-text)]">Paid
                                    </option>
                                    <option value="Cancelled" class="bg-[var(--color-bg)] text-[var(--color-text)]">
                                        Cancelled</option>
                                    <option value="Refunded" class="bg-[var(--color-bg)] text-[var(--color-text)]">
                                        Refunded</option>
                                </select>
                            </div>
                            <div>
                                <label for="bookingSearch"
                                    class="block text-sm font-medium text-[var(--color-text-muted)] mb-1">{{
                                    i18n.t('common.search')
                                    }}</label>
                                <input id="bookingSearch" type="text" (input)="updateSearchQuery($event)"
                                    [placeholder]="i18n.t('dashboard.search')" autocomplete="off"
                                    class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none text-[var(--color-text)] transition-all">
                            </div>
                            <div class="flex items-end">
                                <button (click)="role() === 'Admin' ? loadAllBookings() : loadMyBookings()"
                                    class="w-full px-4 py-2.5 rounded-xl bg-[var(--primary)] text-white font-medium hover:opacity-90 transition-opacity shadow-md">
                                    üîÑ {{ i18n.t('dashboard.refresh') }}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="bookingsLoading()" class="space-y-3">
                        <div class="h-24 bg-[var(--color-surface)] rounded-2xl animate-pulse"></div>
                        <div class="h-24 bg-[var(--color-surface)] rounded-2xl animate-pulse"></div>
                    </div>
                    <div *ngIf="!bookingsLoading() && filteredBookings().length === 0"
                        class="bg-[var(--color-surface)] rounded-2xl p-12 text-center border border-[var(--border)] border-dashed">
                        <div class="text-6xl mb-4 opacity-50">üì≠</div>
                        <h3 class="text-xl font-semibold text-[var(--color-text)] mb-2">{{
                            i18n.t('dashboard.noBookings') }}</h3>
                        <p class="text-[var(--color-text-muted)]">{{ i18n.t('dashboard.adjustFilters') }}</p>
                    </div>
                    <div *ngIf="!bookingsLoading()" class="space-y-4">
                        <div *ngFor="let booking of filteredBookings(); trackBy: trackByBookingId"
                            class="bg-[var(--color-surface)] rounded-2xl p-5 border border-[var(--border)] shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer group"
                            (click)="viewBookingDetails(booking)">

                            <div class="flex flex-col gap-4">
                                <!-- Header: Icon, ID, Status -->
                                <div class="flex items-start justify-between">
                                    <div class="flex items-center gap-4">
                                        <div
                                            class="w-12 h-12 rounded-xl bg-[var(--primary)]/10 flex items-center justify-center text-[var(--primary)] font-bold text-2xl shrink-0">
                                            {{ (booking.type === 'Hajj' || booking.type === '1') ? 'üïã' : 'üïå' }}
                                        </div>
                                        <div>
                                            <h4
                                                class="font-bold text-lg text-[var(--color-text)] flex items-center gap-2">
                                                {{ getBookingNumber(booking) }}
                                                <span class="px-2.5 py-0.5 rounded-full text-xs font-medium border"
                                                    [ngClass]="{
                          'bg-green-50 text-green-700 border-green-200': booking.status === 'Confirmed',
                          'bg-yellow-50 text-yellow-700 border-yellow-200': booking.status === 'Pending',
                          'bg-red-50 text-red-700 border-red-200': booking.status === 'Cancelled',
                          'bg-blue-50 text-blue-700 border-blue-200': booking.status === 'Paid',
                          'bg-purple-50 text-purple-700 border-purple-200': booking.status === 'Refunded'
                        }">{{ booking.status }}</span>
                                            </h4>
                                            <p class="text-sm text-[var(--color-text-muted)]">{{ getBookingType(booking)
                                                }} {{
                                                i18n.t('dashboard.trip') }}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-lg text-[var(--primary)]">{{ booking.totalPrice || 0
                                            | currency:'SAR' }}
                                        </div>
                                        <div class="text-xs text-[var(--color-text-muted)]">{{
                                            formatDate(booking.createdAt) }}</div>
                                    </div>
                                </div>

                                <!-- Main Details Grid -->
                                <div
                                    class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm border-t border-[var(--border)] pt-3 mt-1">
                                    <!-- User Info (Admin) -->
                                    <div *ngIf="role() === 'Admin'"
                                        class="col-span-full flex items-center gap-2 text-[var(--color-text)] font-medium bg-gray-50 dark:bg-zinc-800/50 p-2 rounded-lg">
                                        <lucide-icon name="user" class="w-4 h-4 text-blue-500"></lucide-icon>
                                        {{ getUserName(booking.userId) }}
                                    </div>

                                    <!-- Travel Dates -->
                                    <div class="flex items-center gap-2 text-[var(--color-text-muted)]">
                                        <lucide-icon name="calendar"
                                            class="w-4 h-4 text-[var(--primary)]"></lucide-icon>
                                        <span *ngIf="booking.travelStartDate">
                                            {{ booking.travelStartDate | date:'mediumDate' }}
                                            <span *ngIf="booking.travelEndDate"> - {{ booking.travelEndDate |
                                                date:'mediumDate' }}</span>
                                        </span>
                                        <span *ngIf="!booking.travelStartDate" class="italic opacity-50">{{
                                            i18n.t('dashboard.datesPending')
                                            }}</span>
                                    </div>

                                    <!-- Flight Info -->
                                    <div *ngIf="booking.internationalTransport"
                                        class="flex flex-col gap-1 text-[var(--color-text-muted)]">
                                        <div class="flex items-center gap-2">
                                            <lucide-icon name="plane" class="w-4 h-4 text-blue-500"></lucide-icon>
                                            <span class="font-medium">{{ booking.internationalTransport.carrierName ||
                                                'Flight' }}</span>
                                        </div>
                                        <div class="text-xs pl-6">
                                            <div>GO: {{ booking.internationalTransport.departureDate | date:'shortDate'
                                                }}</div>
                                            <div *ngIf="booking.internationalTransport.returnDate">BACK: {{
                                                booking.internationalTransport.returnDate | date:'shortDate' }}</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Detailed Segments (Mini) -->
                                <div class="flex flex-wrap gap-2 mt-1">
                                    <!-- Makkah -->
                                    <div *ngIf="booking.makkahHotel"
                                        class="inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-orange-50 text-orange-700 text-xs border border-orange-100">
                                        <span>üïã</span>
                                        <span class="font-medium">{{ i18n.t('common.makkah') }}</span>
                                        <span class="opacity-75" *ngIf="booking.makkahHotel.checkInDate">
                                            ({{ booking.makkahHotel.checkInDate | date:'MM/dd' }} - {{
                                            booking.makkahHotel.checkOutDate |
                                            date:'MM/dd' }})
                                        </span>
                                    </div>

                                    <!-- Madinah -->
                                    <div *ngIf="booking.madinahHotel"
                                        class="inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-green-50 text-green-700 text-xs border border-green-100">
                                        <span>üïå</span>
                                        <span class="font-medium">{{ i18n.t('common.madinah') }}</span>
                                        <span class="opacity-75" *ngIf="booking.madinahHotel.checkInDate">
                                            ({{ booking.madinahHotel.checkInDate | date:'MM/dd' }} - {{
                                            booking.madinahHotel.checkOutDate |
                                            date:'MM/dd' }})
                                        </span>
                                    </div>
                                </div>

                                <!-- Visa & Ticket Documents (Strictly Confirmed bookings only) -->
                                <div *ngIf="booking.status === 'Confirmed' && booking.travelers?.length"
                                    class="flex flex-wrap gap-2 mt-3" (click)="$event.stopPropagation()">
                                    <!-- DEBUG: Status is {{booking.status}} -->
                                    <ng-container *ngFor="let traveler of booking.travelers; trackBy: trackByIndex">
                                        <button (click)="downloadDocument(booking, traveler, 'visa')"
                                            class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-blue-50 text-blue-700 text-xs border border-blue-200 hover:bg-blue-100 transition-colors font-medium">
                                            <span>üìÑ</span> Visa - {{ traveler.firstName }}
                                        </button>
                                        <button (click)="downloadDocument(booking, traveler, 'ticket')"
                                            class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-purple-50 text-purple-700 text-xs border border-purple-200 hover:bg-purple-100 transition-colors font-medium">
                                            <span>üé´</span> Ticket - {{ traveler.firstName }}
                                        </button>
                                    </ng-container>
                                </div>

                                <!-- Actions -->
                                <div class="flex flex-wrap gap-2 items-center mt-4" (click)="$event.stopPropagation()">

                                    <!-- Admin Status Dropdown -->
                                    <div *ngIf="role() === 'Admin'" class="relative">
                                        <select (change)="updateBookingStatus(booking.id!, $any($event.target).value)"
                                            [value]="booking.status"
                                            class="px-3 py-2 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-sm font-medium focus:ring-2 focus:ring-[var(--primary)]/20 outline-none cursor-pointer">
                                            <option value="Pending">Pending</option>
                                            <option value="Confirmed">Confirmed</option>
                                            <option value="Paid">Paid</option>
                                            <option value="Cancelled">Cancelled</option>
                                            <option value="Refunded">Refunded</option>
                                        </select>
                                    </div>

                                    <!-- Complete Payment Button (User OR Admin - Pending) -->
                                    <button
                                        *ngIf="(role() === 'User' || role() === 'Admin') && booking.status === 'Pending'"
                                        (click)="completePayment(booking); $event.stopPropagation()"
                                        class="px-4 py-2 rounded-xl bg-green-50 text-green-700 hover:bg-green-100 border border-green-200 text-sm font-medium transition-colors flex items-center gap-2">
                                        <lucide-icon name="credit-card" class="w-4 h-4"></lucide-icon>
                                        {{ i18n.t('dashboard.completePayment') }}
                                    </button>

                                    <!-- User Cancel Button (Only if allowed) -->
                                    <button *ngIf="role() === 'User' && canCancelBooking(booking)"
                                        (click)="cancelBooking(booking); $event.stopPropagation()"
                                        class="px-4 py-2 rounded-xl bg-red-50 text-red-700 hover:bg-red-100 border border-red-200 text-sm font-medium transition-colors flex items-center gap-2">
                                        <lucide-icon name="x-circle" class="w-4 h-4"></lucide-icon>
                                        {{ i18n.t('dashboard.cancelBooking') }}
                                    </button>

                                    <!-- Admin Delete Button -->
                                    <button *ngIf="role() === 'Admin'"
                                        (click)="deleteBooking(booking); $event.stopPropagation()"
                                        class="px-4 py-2 rounded-xl bg-red-50 text-red-700 hover:bg-red-100 border border-red-200 text-sm font-medium transition-colors flex items-center gap-2">
                                        <lucide-icon name="trash-2" class="w-4 h-4"></lucide-icon>
                                        {{ i18n.t('common.delete') }}
                                    </button>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users -->
                <div *ngIf="activeView() === 'users' && role() === 'Admin'" class="space-y-6 animate-fadeIn">
                    <h2 class="text-2xl font-bold text-[var(--color-text)]">{{ i18n.t('dashboard.manageUsers') }}</h2>
                    <div class="bg-[var(--color-surface)] rounded-2xl p-5 border border-[var(--border)] shadow-sm">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="userRoleFilter"
                                    class="block text-sm font-medium text-[var(--color-text-muted)] mb-1">{{
                                    i18n.t('dashboard.role')
                                    }}</label>
                                <select id="userRoleFilter" (change)="updateUserRoleFilter($event)"
                                    class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none text-[var(--color-text)] transition-all">
                                    <option value="all" class="bg-[var(--color-bg)] text-[var(--color-text)]">{{
                                        i18n.t('dashboard.allRoles') }}</option>
                                    <option value="User" class="bg-[var(--color-bg)] text-[var(--color-text)]">User
                                    </option>
                                    <option value="Admin" class="bg-[var(--color-bg)] text-[var(--color-text)]">Admin
                                    </option>
                                    <option value="HotelManager" class="bg-[var(--color-bg)] text-[var(--color-text)]">
                                        Hotel Manager
                                    </option>
                                </select>
                            </div>
                            <div>
                                <label for="userSearch"
                                    class="block text-sm font-medium text-[var(--color-text-muted)] mb-1">{{
                                    i18n.t('common.search')
                                    }}</label>
                                <input id="userSearch" type="text" [value]="searchQuery()"
                                    (input)="updateSearchQuery($event)" [placeholder]="i18n.t('dashboard.search')"
                                    autocomplete="off"
                                    class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none text-[var(--color-text)] transition-all">
                            </div>
                            <div class="flex items-end">
                                <button (click)="loadAllUsers()"
                                    class="w-full px-4 py-2.5 rounded-xl bg-[var(--primary)] text-white font-medium hover:opacity-90 transition-opacity shadow-md">
                                    üîÑ {{ i18n.t('dashboard.refresh') }}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="usersLoading()" class="space-y-4">
                        <div class="h-24 bg-[var(--color-surface)] rounded-2xl animate-pulse"></div>
                        <div class="h-24 bg-[var(--color-surface)] rounded-2xl animate-pulse"></div>
                    </div>
                    <div *ngIf="!usersLoading()" class="space-y-4">
                        <div *ngFor="let user of filteredUsers(); trackBy: trackByUserId"
                            class="bg-[var(--color-surface)] rounded-2xl p-6 border border-[var(--border)] shadow-sm hover:shadow-md transition-all duration-200">
                            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center text-white font-bold text-2xl shadow-lg">
                                        {{ user.firstName.charAt(0) }}{{ user.lastName.charAt(0) }}
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-lg text-[var(--color-text)] mb-1">{{ user.fullName }}
                                        </h4>
                                        <div class="text-sm text-[var(--color-text-muted)] mb-2">üìß {{ user.email }}
                                        </div>
                                        <div class="flex flex-wrap gap-2">
                                            <span *ngFor="let userRole of user.roles"
                                                class="px-3 py-1 rounded-full text-xs font-medium bg-[var(--primary)]/10 text-[var(--primary)] border border-[var(--primary)]/20">{{
                                                userRole }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    <button (click)="openRoleModal(user)"
                                        class="px-4 py-2 rounded-xl bg-blue-50 text-blue-700 hover:bg-blue-100 border border-blue-200 font-medium text-sm transition-colors">‚ûï
                                        {{ i18n.t('dashboard.assignRole') }}</button>
                                    <button *ngFor="let userRole of user.roles" (click)="removeRole(user, userRole)"
                                        class="px-4 py-2 rounded-xl bg-red-50 text-red-700 hover:bg-red-100 border border-red-200 font-medium text-sm transition-colors">‚ùå
                                        {{ userRole }}</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hotels -->
                <div *ngIf="activeView() === 'hotels'" class="space-y-6 animate-fadeIn">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-bold text-[var(--color-text)]">{{ i18n.t('dashboard.manageHotels') }}
                        </h2>
                        <button (click)="openHotelModal()"
                            class="px-5 py-2.5 rounded-xl bg-[var(--primary)] text-white font-medium hover:opacity-90 transition-opacity shadow-md flex items-center gap-2">
                            <span>‚ûï</span> {{ i18n.t('dashboard.addHotel') }}
                        </button>
                    </div>

                    <div *ngIf="hotelsLoading()" class="space-y-4">
                        <div class="h-24 bg-[var(--color-surface)] rounded-2xl animate-pulse"></div>
                        <div class="h-24 bg-[var(--color-surface)] rounded-2xl animate-pulse"></div>
                    </div>

                    <div *ngIf="!hotelsLoading() && displayedHotels().length === 0"
                        class="bg-[var(--color-surface)] rounded-2xl p-12 text-center border border-[var(--border)] border-dashed">
                        <div class="text-6xl mb-4 opacity-50">üè®</div>
                        <h3 class="text-xl font-semibold text-[var(--color-text)] mb-2">{{ i18n.t('dashboard.noHotels')
                            }}</h3>
                        <p class="text-[var(--color-text-muted)]">{{ i18n.t('dashboard.noHotelsMessage') }}</p>
                    </div>

                    <div *ngIf="!hotelsLoading()" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div *ngFor="let hotel of displayedHotels(); trackBy: trackByHotelId"
                            class="bg-[var(--color-surface)] rounded-2xl border border-[var(--border)] shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden">
                            <div class="aspect-video bg-[var(--color-surface)] relative">
                                <img [src]="getHotelImage(hotel)" [alt]="hotel.name" (error)="handleImageError($event)"
                                    class="w-full h-full object-cover">
                            </div>
                            <div class="p-5">
                                <div class="mb-3">
                                    <h3 class="font-bold text-lg text-[var(--color-text)] mb-1">{{ hotel.name }}</h3>
                                    <p class="text-sm text-[var(--color-text-muted)]">üìç {{ hotel.city }}</p>
                                </div>
                                <div class="flex items-center gap-4 mb-3 text-sm text-[var(--color-text)]">
                                    <span>‚≠ê {{ hotel.starRating }}/5</span>
                                    <span>üïå {{ hotel.distanceToHaram }}km</span>
                                    <span>üõèÔ∏è {{ hotel.availableRooms }} {{ i18n.t('dashboard.rooms') }}</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-bold text-xl text-[var(--primary)]">{{ hotel.pricePerNight }}
                                            SAR</div>
                                        <div class="text-xs text-[var(--color-text-muted)]">{{
                                            i18n.t('dashboard.perNight') }}</div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button (click)="openHotelModal(hotel)"
                                            class="p-2 rounded-xl bg-blue-50 text-blue-700 hover:bg-blue-100 border border-blue-200 transition-colors">‚úèÔ∏è</button>
                                        <button (click)="deleteHotel(hotel.id!)"
                                            class="p-2 rounded-xl bg-red-50 text-red-700 hover:bg-red-100 border border-red-200 transition-colors">üóëÔ∏è</button>
                                        <button (click)="viewHotelDetails(hotel)"
                                            class="p-2 rounded-xl bg-[var(--color-surface)] text-[var(--color-text)] hover:bg-[var(--color-surface)] border border-[var(--border)] transition-colors">üîç</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- International Transport -->
                <div *ngIf="activeView() === 'international-transport'" class="space-y-6 animate-fadeIn">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-bold text-[var(--color-text)]">{{ i18n.t('dashboard.intlTransport') }}
                        </h2>
                        <button (click)="openInternationalTransportModal()"
                            class="px-5 py-2.5 rounded-xl bg-[var(--primary)] text-white font-medium hover:opacity-90 transition-opacity shadow-md flex items-center gap-2">
                            <span>‚ûï</span> {{ i18n.t('dashboard.addTransport') }}
                        </button>
                    </div>

                    <div *ngIf="internationalTransportsLoading()" class="space-y-4">
                        <div class="h-24 bg-[var(--color-surface)] rounded-2xl animate-pulse"></div>
                    </div>

                    <div *ngIf="!internationalTransportsLoading() && allInternationalTransports().length === 0"
                        class="bg-[var(--color-surface)] rounded-2xl p-12 text-center border border-[var(--border)] border-dashed">
                        <div class="text-6xl mb-4 opacity-50">‚úàÔ∏è</div>
                        <h3 class="text-xl font-semibold text-[var(--color-text)] mb-2">{{
                            i18n.t('dashboard.noTransports') }}
                        </h3>
                        <p class="text-[var(--color-text-muted)]">{{ i18n.t('dashboard.noTransportMessage') }}</p>
                    </div>

                    <div *ngIf="!internationalTransportsLoading()" class="space-y-4">
                        <div *ngFor="let transport of allInternationalTransports(); trackBy: trackByIntTransportId"
                            class="bg-[var(--color-surface)] rounded-2xl p-6 border border-[var(--border)] shadow-sm hover:shadow-md transition-all duration-200">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-2">
                                        <h3 class="font-bold text-lg text-[var(--color-text)]">{{ transport.carrierName
                                            }}</h3>
                                        <span
                                            class="px-3 py-1 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200">
                                            {{ transport.transportType }}
                                        </span>
                                    </div>
                                    <div class="space-y-3 mt-2">
                                        <!-- GO LEG -->
                                        <div class="flex items-start gap-2">
                                            <div
                                                class="px-2 py-0.5 rounded bg-[var(--primary)]/10 text-[var(--primary)] text-xs font-bold uppercase tracking-wider shrink-0 mt-0.5">
                                                GO
                                            </div>
                                            <div class="text-sm">
                                                <div class="font-medium text-[var(--color-text)]">
                                                    {{ transport.departureAirport }} ‚ûù {{ transport.arrivalAirport }}
                                                </div>
                                                <div class="text-[var(--color-text-muted)] flex items-center gap-2">
                                                    <span>üìÖ {{ formatDate(transport.departureDate) }}</span>
                                                    <span>‚Ä¢ {{ transport.departureDate | date:'shortTime' }}</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- BACK LEG (If return date exists) -->
                                        <div *ngIf="transport.returnDate" class="flex items-start gap-2">
                                            <div
                                                class="px-2 py-0.5 rounded bg-orange-50 text-orange-600 text-xs font-bold uppercase tracking-wider shrink-0 mt-0.5">
                                                BACK
                                            </div>
                                            <div class="text-sm">
                                                <div class="font-medium text-[var(--color-text)]">
                                                    {{ transport.arrivalAirport }} ‚ûù {{ transport.departureAirport }}
                                                </div>
                                                <div class="text-[var(--color-text-muted)] flex items-center gap-2">
                                                    <span>üìÖ {{ formatDate(transport.returnDate) }}</span>
                                                    <span>‚Ä¢ {{ transport.returnDate | date:'shortTime' }}</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div
                                            class="pt-2 border-t border-[var(--border)] mt-2 flex flex-wrap gap-3 text-xs text-[var(--color-text-muted)]">
                                            <div title="Duration">‚è±Ô∏è {{ transport.duration || 'N/A' }}</div>
                                            <div title="Stops">üõë {{ transport.stops || 'Direct' }}</div>
                                            <div title="Flight Number">üé´ #{{ transport.flightNumber || 'N/A' }}</div>
                                            <div title="Class">üí∫ {{ transport.flightClass || 'Economy' }}</div>
                                            <div title="Available Seats">üë• {{ transport.availableSeats }} / {{
                                                transport.totalSeats }}</div>
                                        </div>

                                        <div class="text-xs font-medium"
                                            [ngClass]="{'text-green-600': transport.isActive, 'text-red-600': !transport.isActive}">
                                            ‚óè {{ transport.isActive ? 'Active' : 'Inactive' }}
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-2xl text-[var(--primary)]">{{ transport.price }} SAR
                                    </div>
                                    <div class="text-xs text-[var(--color-text-muted)]">{{ i18n.t('dashboard.perPerson')
                                        }}</div>
                                </div>
                                <div class="flex gap-2">
                                    <button (click)="openInternationalTransportModal(transport)"
                                        class="p-3 rounded-xl bg-[var(--color-surface)] text-[var(--color-text)] hover:bg-[var(--color-surface)] border border-[var(--border)] transition-colors">‚úèÔ∏è</button>
                                    <button (click)="deleteInternationalTransport(transport.id!)"
                                        class="p-3 rounded-xl bg-red-50 text-red-700 hover:bg-red-100 border border-red-200 transition-colors">üóëÔ∏è</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ground Transport -->
                <div *ngIf="activeView() === 'ground-transport'" class="space-y-6 animate-fadeIn">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-bold text-[var(--color-text)]">{{ i18n.t('dashboard.groundTransport')
                            }}</h2>
                        <button (click)="openGroundTransportModal()"
                            class="px-5 py-2.5 rounded-xl bg-[var(--primary)] text-white font-medium hover:opacity-90 transition-opacity shadow-md flex items-center gap-2">
                            <span>‚ûï</span> {{ i18n.t('dashboard.addTransport') }}
                        </button>
                    </div>

                    <div *ngIf="groundTransportsLoading()" class="space-y-4">
                        <div class="h-24 bg-[var(--color-surface)] rounded-2xl animate-pulse"></div>
                    </div>

                    <div *ngIf="!groundTransportsLoading() && allGroundTransports().length === 0"
                        class="bg-[var(--color-surface)] rounded-2xl p-12 text-center border border-[var(--border)] border-dashed">
                        <div class="text-6xl mb-4 opacity-50">üöå</div>
                        <h3 class="text-xl font-semibold text-[var(--color-text)] mb-2">{{
                            i18n.t('dashboard.noTransports') }}
                        </h3>
                        <p class="text-[var(--color-text-muted)]">{{ i18n.t('dashboard.noTransportMessage') }}</p>
                    </div>

                    <div *ngIf="!groundTransportsLoading()" class="space-y-4">
                        <div *ngFor="let transport of allGroundTransports(); trackBy: trackByGroundTransportId"
                            class="bg-[var(--color-surface)] rounded-2xl p-6 border border-[var(--border)] shadow-sm hover:shadow-md transition-all duration-200 flex flex-col md:flex-row justify-between items-center gap-6">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="font-bold text-lg text-[var(--color-text)]">{{ transport.serviceName }}
                                    </h3>
                                    <span
                                        class="px-3 py-1 rounded-full text-xs font-medium bg-orange-50 text-orange-700 border border-orange-200">
                                        {{ getTransportTypeName(transport.type, false) }}
                                    </span>
                                </div>
                                <div class="text-sm text-[var(--color-text-muted)]">
                                    {{ i18n.t('dashboard.capacity') }}: {{ transport.capacity }} {{
                                    i18n.t('dashboard.person') }}
                                </div>
                            </div>
                            <div class="text-right min-w-[120px]">
                                <div class="font-bold text-2xl text-[var(--primary)]">{{ transport.pricePerPerson }} SAR
                                </div>
                                <div class="text-xs text-[var(--color-text-muted)]">{{ i18n.t('common.perPerson') }}
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button (click)="openGroundTransportModal(transport)"
                                    class="p-3 rounded-xl bg-[var(--color-surface)] text-[var(--color-text)] hover:bg-[var(--color-surface)] border border-[var(--border)] transition-colors">‚úèÔ∏è</button>
                                <button (click)="deleteGroundTransport(transport.id!)"
                                    class="p-3 rounded-xl bg-red-50 text-red-700 hover:bg-red-100 border border-red-200 transition-colors">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- Role Modal -->
    <div *ngIf="showRoleModal()"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fadeIn"
        (click)="showRoleModal.set(false)">
        <div class="bg-[var(--color-surface)] rounded-2xl p-8 max-w-md w-full shadow-2xl border border-[var(--border)] transform transition-all scale-100"
            (click)="$event.stopPropagation()">
            <h3 class="text-2xl font-bold mb-6">{{ i18n.t('dashboard.assignRole') }}</h3>
            <div class="mb-6">
                <p class="text-sm text-[var(--color-text-muted)] mb-4">{{ i18n.t('dashboard.assignRole') }} to <span
                        class="font-semibold text-[var(--color-text)]">{{ selectedUser()?.fullName }}</span></p>
                <label for="roleSelect" class="block text-sm font-medium text-[var(--color-text-muted)] mb-2">{{
                    i18n.t('dashboard.selectRole')
                    }}</label>
                <select id="roleSelect" (change)="updateRoleToAssign($event)"
                    class="w-full px-4 py-3 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none text-[var(--color-text)]">
                    <option value="User" class="bg-[var(--color-bg)] text-[var(--color-text)]">User</option>
                    <option value="Admin" class="bg-[var(--color-bg)] text-[var(--color-text)]">Admin</option>
                    <option value="HotelManager" class="bg-[var(--color-bg)] text-[var(--color-text)]">Hotel Manager
                    </option>
                </select>
            </div>
            <div class="flex gap-3">
                <button (click)="assignRole()"
                    class="flex-1 px-4 py-3 rounded-xl bg-[var(--primary)] text-white font-medium hover:opacity-90 transition-opacity">{{
                    i18n.t('dashboard.confirm') }}</button>
                <button (click)="showRoleModal.set(false)"
                    class="flex-1 px-4 py-3 rounded-xl bg-[var(--color-bg)] border border-[var(--border)] font-medium hover:bg-[var(--color-surface)] transition-colors">{{
                    i18n.t('common.cancel') }}</button>
            </div>
        </div>
    </div>

    <!-- Hotel Modal -->
    <div *ngIf="showHotelModal()"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fadeIn"
        (click)="showHotelModal.set(false)">
        <div class="bg-[var(--color-surface)] rounded-2xl max-w-4xl w-full shadow-2xl border border-[var(--border)] max-h-[90vh] flex flex-col"
            (click)="$event.stopPropagation()">
            <div class="p-6 md:p-8 border-b border-[var(--border)] flex-shrink-0">
                <h3 class="text-2xl font-bold text-[var(--color-text)]">{{ selectedHotel() ?
                    i18n.t('dashboard.editHotel') :
                    i18n.t('dashboard.addHotel') }}</h3>
            </div>

            <form #hotelForm="ngForm" (ngSubmit)="hotelForm.valid && saveHotel()"
                class="flex flex-col flex-1 overflow-hidden">
                <div class="p-6 md:p-8 overflow-y-auto flex-1">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <!-- Basic Info -->
                        <div class="md:col-span-2">
                            <h4 class="text-lg font-semibold mb-3 text-[var(--color-text)]">{{
                                i18n.t('dashboard.basicInfo') }}</h4>
                        </div>

                        <div class="md:col-span-2">
                            <label for="hotelName" class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.hotelName')
                                }}
                                <span class="text-red-500">*</span></label>
                            <input id="hotelName" type="text" [(ngModel)]="hotelFormData.name" name="name" required
                                minlength="2" maxlength="200" #hName="ngModel"
                                class="w-full px-4 py-2.5 rounded-xl border bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none transition-all"
                                [class.border-red-500]="hName.invalid && hName.touched"
                                [class.border-[var(--border)]]="!(hName.invalid && hName.touched)">
                            <span *ngIf="hName.invalid && hName.touched" class="text-xs text-red-500 mt-1 block">{{
                                i18n.t('common.required') }} (min 2 chars)</span>
                        </div>

                        <div>
                            <label for="hotelCity" class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.city')
                                }} <span class="text-red-500">*</span></label>
                            <select id="hotelCity" [(ngModel)]="hotelFormData.city" name="city" #hCity="ngModel"
                                required
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none"
                                [class.border-red-500]="hCity.invalid && hCity.touched">
                                <option value="Makkah">Makkah</option>
                                <option value="Madinah">Madinah</option>
                            </select>
                            <span *ngIf="hCity.invalid && hCity.touched" class="text-xs text-red-500 mt-1 block">{{
                                i18n.t('common.required') }}</span>
                        </div>

                        <div>
                            <label for="hotelRating"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.starRating')
                                }} <span class="text-red-500">*</span></label>
                            <div class="flex items-center gap-2">
                                <input id="hotelRating" type="range" [(ngModel)]="hotelFormData.starRating"
                                    name="starRating" min="1" max="5" step="1" class="flex-1 accent-[var(--primary)]">
                                <span class="font-bold text-lg w-8 text-center text-[var(--color-text)]">{{
                                    hotelFormData.starRating
                                    }}</span>
                                <span class="text-yellow-400">‚òÖ</span>
                            </div>
                        </div>

                        <div class="md:col-span-2">
                            <label for="hotelAddress"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.address') }}
                                <span class="text-red-500">*</span></label>
                            <input id="hotelAddress" type="text" [(ngModel)]="hotelFormData.address" name="address"
                                required minlength="5" #hAddress="ngModel"
                                class="w-full px-4 py-2.5 rounded-xl border bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none"
                                [class.border-red-500]="hAddress.invalid && hAddress.touched"
                                [class.border-[var(--border)]]="!(hAddress.invalid && hAddress.touched)">
                            <span *ngIf="hAddress.invalid && hAddress.touched"
                                class="text-xs text-red-500 mt-1 block">{{
                                i18n.t('common.required') }}</span>
                        </div>

                        <div>
                            <label for="hotelDistance"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.distance')
                                }}
                                (km) <span class="text-red-500">*</span></label>
                            <input id="hotelDistance" type="number" [(ngModel)]="hotelFormData.distanceToHaram"
                                name="distanceToHaram" required min="0" max="50" #hDist="ngModel"
                                class="w-full px-4 py-2.5 rounded-xl border bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none"
                                [class.border-red-500]="hDist.invalid && hDist.touched"
                                [class.border-[var(--border)]]="!(hDist.invalid && hDist.touched)">
                            <span *ngIf="hDist.invalid && hDist.touched" class="text-xs text-red-500 mt-1 block">
                                <span *ngIf="hDist.errors?.['required']">{{ i18n.t('common.required') }}</span>
                                <span *ngIf="hDist.errors?.['min']">Min 0</span>
                                <span *ngIf="hDist.errors?.['max']">Max 50</span>
                            </span>
                        </div>

                        <div class="md:col-span-2">
                            <label for="hotelDescription"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.description')
                                }}</label>
                            <textarea id="hotelDescription" [(ngModel)]="hotelFormData.description" name="description"
                                rows="3"
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none"></textarea>
                        </div>

                        <!-- Image Upload -->
                        <div class="md:col-span-2">
                            <label for="hotelImage" class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.image')
                                }}</label>
                            <div class="flex items-center gap-4">
                                <div *ngIf="hotelFormData.imageUrl || imagePreviewUrl"
                                    class="w-20 h-20 rounded-lg overflow-hidden bg-gray-100 border border-gray-200">
                                    <img [src]="imagePreviewUrl ? imagePreviewUrl : getHotelImage(hotelFormData)"
                                        class="w-full h-full object-cover" alt="Preview">
                                </div>
                                <input id="hotelImage" type="file" (change)="onFileSelected($event)" accept="image/*"
                                    class="block w-full text-sm text-[var(--color-text-muted)] file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[var(--primary)]/10 file:text-[var(--primary)] hover:file:bg-[var(--primary)]/20">
                            </div>
                        </div>

                        <!-- Rooms Section -->
                        <div class="md:col-span-2 mt-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-lg font-semibold text-[var(--color-text)]">{{ i18n.t('dashboard.rooms')
                                    }} <span class="text-red-500">*</span></h4>
                                <button type="button" (click)="addRoom()"
                                    class="text-sm px-3 py-1.5 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 font-medium transition-colors">
                                    + {{ i18n.t('dashboard.addRoom') }}
                                </button>
                            </div>

                            <div *ngIf="!hotelFormData.rooms?.length"
                                class="p-4 bg-yellow-50 dark:bg-yellow-900/10 text-yellow-700 dark:text-yellow-400 rounded-xl text-center text-sm">
                                Please add at least one room type.
                            </div>

                            <div class="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                                <div *ngFor="let room of hotelFormData.rooms; let i = index; trackBy: trackByIndex"
                                    class="p-4 bg-[var(--color-bg)] rounded-xl border border-[var(--border)] relative group">
                                    <button type="button" (click)="removeRoom(i)"
                                        [disabled]="(hotelFormData.rooms?.length ?? 0) <= 1"
                                        class="absolute top-2 right-2 p-1.5 text-red-500 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-30 disabled:cursor-not-allowed">
                                        <lucide-icon name="trash-2" class="w-4 h-4"></lucide-icon>
                                    </button>

                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                        <div>
                                            <label [for]="'roomType'+i"
                                                class="text-xs text-[var(--color-text-muted)] mb-1 block">Type</label>
                                            <select [id]="'roomType'+i" [(ngModel)]="room.roomType"
                                                [name]="'roomType'+i" required
                                                class="w-full px-2 py-1.5 rounded-lg border border-[var(--border)] bg-[var(--color-surface)] text-sm text-[var(--color-text)]">
                                                <option *ngFor="let type of roomTypes()" [value]="type">{{ type }}
                                                </option>
                                            </select>
                                        </div>
                                        <div>
                                            <label [for]="'roomPrice'+i"
                                                class="text-xs text-[var(--color-text-muted)] mb-1 block">Price</label>
                                            <input [id]="'roomPrice'+i" type="number" [(ngModel)]="room.pricePerNight"
                                                [name]="'roomPrice'+i" required min="1"
                                                class="w-full px-2 py-1.5 rounded-lg border border-[var(--border)] bg-[var(--color-surface)] text-sm text-[var(--color-text)]">
                                        </div>
                                        <div>
                                            <label [for]="'roomCap'+i"
                                                class="text-xs text-[var(--color-text-muted)] mb-1 block">Capacity</label>
                                            <input [id]="'roomCap'+i" type="number" [(ngModel)]="room.capacity"
                                                [name]="'roomCap'+i" required min="1"
                                                class="w-full px-2 py-1.5 rounded-lg border border-[var(--border)] bg-[var(--color-surface)] text-sm text-[var(--color-text)]">
                                        </div>
                                        <div>
                                            <label [for]="'roomAvail'+i"
                                                class="text-xs text-[var(--color-text-muted)] mb-1 block">Available</label>
                                            <input [id]="'roomAvail'+i" type="number" [(ngModel)]="room.availableRooms"
                                                [name]="'roomAvail'+i" required min="0"
                                                class="w-full px-2 py-1.5 rounded-lg border border-[var(--border)] bg-[var(--color-surface)] text-sm text-[var(--color-text)]">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div
                    class="flex gap-3 p-6 md:p-8 border-t border-[var(--border)] flex-shrink-0 bg-[var(--color-surface)]">
                    <button type="submit" [disabled]="!hotelForm.valid || !hotelFormData.rooms?.length"
                        class="flex-1 px-4 py-3 rounded-xl bg-[var(--primary)] text-white font-medium hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed">
                        {{ i18n.t('common.save') }}
                    </button>
                    <button type="button" (click)="showHotelModal.set(false)"
                        class="flex-1 px-4 py-3 rounded-xl bg-[var(--color-bg)] border border-[var(--border)] text-[var(--color-text)] font-medium hover:bg-[var(--color-surface)] transition-colors">
                        {{ i18n.t('common.cancel') }}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- International Transport Modal -->
    <div *ngIf="showInternationalTransportModal()"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fadeIn"
        (click)="showInternationalTransportModal.set(false)">
        <div class="bg-[var(--color-surface)] rounded-2xl max-w-2xl w-full shadow-2xl border border-[var(--border)] max-h-[90vh] flex flex-col"
            (click)="$event.stopPropagation()">
            <div class="p-6 md:p-8 border-b border-[var(--border)] flex-shrink-0">
                <h3 class="text-2xl font-bold text-[var(--color-text)]">{{ selectedInternationalTransport() ?
                    i18n.t('dashboard.editTransport') : i18n.t('dashboard.addTransport') }}</h3>
            </div>

            <form #transportForm="ngForm" (ngSubmit)="transportForm.valid && saveInternationalTransport()"
                class="flex flex-col flex-1 overflow-hidden">
                <div class="p-6 md:p-8 overflow-y-auto flex-1">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div class="md:col-span-2">
                            <label for="carrierName"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">Airline Company
                                <span class="text-red-500">*</span></label>
                            <select id="carrierName" [(ngModel)]="internationalTransportFormData.carrierName"
                                name="carrierName" #carrier="ngModel" required
                                class="w-full px-4 py-2.5 rounded-xl border bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none"
                                [class.border-red-500]="carrier.invalid && carrier.touched"
                                [class.border-[var(--border)]]="!(carrier.invalid && carrier.touched)">
                                <option value="" disabled>Select Airline</option>
                                <option *ngFor="let airline of airlineCompanies" [value]="airline.value">{{
                                    airline.label }}</option>
                            </select>
                            <span *ngIf="carrier.invalid && carrier.touched" class="text-xs text-red-500 mt-1 block">{{
                                i18n.t('common.required') }}</span>
                        </div>

                        <div>
                            <label for="transportType"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">Type <span
                                    class="text-red-500">*</span></label>
                            <select id="transportType" [(ngModel)]="internationalTransportFormData.transportType"
                                name="type" required
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none">
                                <option value="Plane">Plane</option>
                                <option value="Ship">Ship</option>
                            </select>
                        </div>

                        <div>
                            <label for="flightNumber"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">Flight Number
                                <span class="text-red-500">*</span></label>
                            <input id="flightNumber" type="text"
                                [(ngModel)]="internationalTransportFormData.flightNumber" name="flightNumber"
                                #flightNumber="ngModel" required maxlength="50"
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] outline-none"
                                [class.border-red-500]="flightNumber.invalid && flightNumber.touched">
                            <span *ngIf="flightNumber.invalid && flightNumber.touched"
                                class="text-xs text-red-500 mt-1 block">{{
                                i18n.t('common.required') }}</span>
                        </div>

                        <div>
                            <label for="flightClass"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">Flight Class
                                <span class="text-red-500">*</span></label>
                            <select id="flightClass" [(ngModel)]="internationalTransportFormData.flightClass"
                                name="flightClass" #flightClass="ngModel" required
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] outline-none"
                                [class.border-red-500]="flightClass.invalid && flightClass.touched">
                                <option value="Economy">Economy</option>
                                <option value="Business">Business</option>
                                <option value="First">First</option>
                            </select>
                            <span *ngIf="flightClass.invalid && flightClass.touched"
                                class="text-xs text-red-500 mt-1 block">{{
                                i18n.t('common.required') }}</span>
                        </div>

                        <div>
                            <label for="stops" class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">Stops
                                <span class="text-red-500">*</span></label>
                            <input id="stops" type="text" [(ngModel)]="internationalTransportFormData.stops"
                                name="stops" #stops="ngModel" required maxlength="50" placeholder="e.g. Direct, 1 Stop"
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] outline-none"
                                [class.border-red-500]="stops.invalid && stops.touched">
                            <span *ngIf="stops.invalid && stops.touched" class="text-xs text-red-500 mt-1 block">{{
                                i18n.t('common.required') }}</span>
                        </div>

                        <div>
                            <label for="flightPrice"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">Price (SAR)
                                <span class="text-red-500">*</span></label>
                            <input id="flightPrice" type="number" [(ngModel)]="internationalTransportFormData.price"
                                name="price" required min="1"
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] outline-none">
                        </div>

                        <div>
                            <label for="depAirport" class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.departureAirport') }}
                                <span class="text-red-500">*</span></label>
                            <select id="depAirport" [(ngModel)]="internationalTransportFormData.departureAirport"
                                name="departureAirport" required
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] outline-none">
                                <option value="" disabled>Select Departure Airport</option>
                                <option *ngFor="let airport of departureAirports" [value]="airport.value">{{
                                    airport.label }}</option>
                            </select>
                        </div>

                        <div>
                            <label for="arrAirport" class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.arrivalAirport') }}
                                <span class="text-red-500">*</span></label>
                            <select id="arrAirport" [(ngModel)]="internationalTransportFormData.arrivalAirport"
                                name="arrivalAirport" required
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] outline-none">
                                <option value="" disabled>Select Arrival Airport</option>
                                <option *ngFor="let airport of arrivalAirports" [value]="airport.value">{{ airport.label
                                    }}</option>
                            </select>
                        </div>

                        <div>
                            <label for="depDate" class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.departureDate') }} <span class="text-red-500">*</span></label>
                            <input id="depDate" type="datetime-local"
                                [(ngModel)]="internationalTransportFormData.departureDate" name="departureDate" required
                                (ngModelChange)="onDepartureDateChange()"
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] outline-none">
                        </div>

                        <div>
                            <label for="arrDate" class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.arrivalDate')
                                }} <span class="text-red-500">*</span></label>
                            <input id="arrDate" type="datetime-local"
                                [(ngModel)]="internationalTransportFormData.arrivalDate" name="arrivalDate" required
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] outline-none">
                        </div>

                        <div>
                            <label for="retDate"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">Return Date & Time
                                <span class="text-red-500">*</span></label>
                            <input id="retDate" type="datetime-local"
                                [(ngModel)]="internationalTransportFormData.returnDate" name="returnDate" required
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] outline-none">
                        </div>

                        <div>
                            <label for="totalSeats"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">Total Seats
                                <span class="text-red-500">*</span></label>
                            <input id="totalSeats" type="number" [(ngModel)]="internationalTransportFormData.totalSeats"
                                name="totalSeats" required min="1"
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] outline-none">
                        </div>
                        <div>
                            <label for="availSeats"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">Available Seats
                                <span class="text-red-500">*</span></label>
                            <input id="availSeats" type="number"
                                [(ngModel)]="internationalTransportFormData.availableSeats" name="availableSeats"
                                #avail="ngModel" required min="0"
                                [max]="internationalTransportFormData.totalSeats || 1000"
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] outline-none"
                                [class.border-red-500]="avail.invalid && avail.touched">
                            <span *ngIf="avail.invalid && avail.touched" class="text-xs text-red-500 mt-1 block">
                                <span *ngIf="avail.errors?.['required']">{{ i18n.t('common.required') }}</span>
                                <span *ngIf="avail.errors?.['min']">Min 0</span>
                                <span *ngIf="avail.errors?.['max']">Cannot exceed Total Seats</span>
                            </span>
                        </div>
                    </div>
                </div>

                <div
                    class="flex gap-3 p-6 md:p-8 border-t border-[var(--border)] flex-shrink-0 bg-[var(--color-surface)]">
                    <button type="submit" [disabled]="!transportForm.valid"
                        class="flex-1 px-4 py-3 rounded-xl bg-[var(--primary)] text-white font-medium hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed">
                        {{ i18n.t('common.save') }}
                    </button>
                    <button type="button" (click)="showInternationalTransportModal.set(false)"
                        class="flex-1 px-4 py-3 rounded-xl bg-[var(--color-bg)] border border-[var(--border)] text-[var(--color-text)] font-medium hover:bg-[var(--color-surface)] transition-colors">
                        {{ i18n.t('common.cancel') }}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ground Transport Modal -->
    <div *ngIf="showGroundTransportModal()"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fadeIn"
        (click)="showGroundTransportModal.set(false)">
        <div class="bg-[var(--color-surface)] rounded-2xl max-w-2xl w-full shadow-2xl border border-[var(--border)] max-h-[90vh] flex flex-col"
            (click)="$event.stopPropagation()">
            <div class="p-6 md:p-8 border-b border-[var(--border)] flex-shrink-0">
                <h3 class="text-2xl font-bold text-[var(--color-text)]">{{ selectedGroundTransport() ?
                    i18n.t('dashboard.editTransport') : i18n.t('dashboard.addTransport') }}</h3>
            </div>

            <form #groundForm="ngForm" (ngSubmit)="groundForm.valid && saveGroundTransport()"
                class="flex flex-col flex-1 overflow-hidden">
                <div class="p-6 md:p-8 overflow-y-auto flex-1">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div>
                            <label for="destinationFrom"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">Destination
                                From
                                <span class="text-red-500">*</span></label>
                            <input id="destinationFrom" type="text" [(ngModel)]="groundTransportFormData.route"
                                name="destinationFrom" #destFrom="ngModel" required placeholder="e.g. Makkah"
                                class="w-full px-4 py-2.5 rounded-xl border bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none"
                                [class.border-red-500]="destFrom.invalid && destFrom.touched"
                                [class.border-[var(--border)]]="!(destFrom.invalid && destFrom.touched)">
                            <span *ngIf="destFrom.invalid && destFrom.touched"
                                class="text-xs text-red-500 mt-1 block">{{
                                i18n.t('common.required') }}</span>
                        </div>
                        <div>
                            <label for="destinationTo"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">Destination
                                To
                                <span class="text-red-500">*</span></label>
                            <input id="destinationTo" type="text" [(ngModel)]="groundTransportFormData.duration"
                                name="destinationTo" #destTo="ngModel" required placeholder="e.g. Madinah"
                                class="w-full px-4 py-2.5 rounded-xl border bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none"
                                [class.border-red-500]="destTo.invalid && destTo.touched"
                                [class.border-[var(--border)]]="!(destTo.invalid && destTo.touched)">
                            <span *ngIf="destTo.invalid && destTo.touched" class="text-xs text-red-500 mt-1 block">{{
                                i18n.t('common.required') }}</span>
                        </div>
                        <div>
                            <label for="groundType" class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.transportType') }} <span class="text-red-500">*</span></label>
                            <select id="groundType" [(ngModel)]="groundTransportFormData.type" name="type"
                                #gType="ngModel" required
                                class="w-full px-4 py-2.5 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none"
                                [class.border-red-500]="gType.invalid && gType.touched">
                                <option value="PublicBus">Public Bus</option>
                                <option value="Train">Train</option>
                                <option value="UberCareem">Uber / Careem</option>
                                <option value="PrivateCar">Private Car</option>
                            </select>
                            <span *ngIf="gType.invalid && gType.touched" class="text-xs text-red-500 mt-1 block">{{
                                i18n.t('common.required') }}</span>
                        </div>
                        <div>
                            <label for="groundCapacity"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">{{
                                i18n.t('dashboard.capacity')
                                }}
                                <span class="text-red-500">*</span></label>
                            <input id="groundCapacity" type="number" [(ngModel)]="groundTransportFormData.capacity"
                                name="capacity" #capacity="ngModel" required min="1" max="100"
                                class="w-full px-4 py-2.5 rounded-xl border bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none"
                                [class.border-red-500]="capacity.invalid && capacity.touched"
                                [class.border-[var(--border)]]="!(capacity.invalid && capacity.touched)">
                            <span *ngIf="capacity.invalid && capacity.touched" class="text-xs text-red-500 mt-1 block">
                                <span *ngIf="capacity.errors?.['required']">{{ i18n.t('common.required') }}</span>
                                <span *ngIf="capacity.errors?.['min']">Min 1</span>
                                <span *ngIf="capacity.errors?.['max']">Max 100</span>
                            </span>
                        </div>
                        <div class="md:col-span-2">
                            <label for="groundPrice"
                                class="block text-sm font-medium mb-1.5 text-[var(--color-text)]">Price (SAR)
                                <span class="text-red-500">*</span></label>
                            <input id="groundPrice" type="number" [(ngModel)]="groundTransportFormData.pricePerPerson"
                                name="price" #gPrice="ngModel" required min="0.01" max="10000"
                                class="w-full px-4 py-2.5 rounded-xl border bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[var(--primary)]/20 outline-none"
                                [class.border-red-500]="gPrice.invalid && gPrice.touched"
                                [class.border-[var(--border)]]="!(gPrice.invalid && gPrice.touched)">
                            <span *ngIf="gPrice.invalid && gPrice.touched" class="text-xs text-red-500 mt-1 block">
                                <span *ngIf="gPrice.errors?.['required']">{{ i18n.t('common.required') }}</span>
                                <span *ngIf="gPrice.errors?.['min']">Min 0.01</span>
                                <span *ngIf="gPrice.errors?.['max']">Max 10000</span>
                            </span>
                        </div>
                    </div>
                </div>

                <div
                    class="flex gap-3 p-6 md:p-8 border-t border-[var(--border)] flex-shrink-0 bg-[var(--color-surface)]">
                    <button type="submit" [disabled]="!groundForm.valid"
                        class="flex-1 px-4 py-3 rounded-xl bg-[var(--primary)] text-white font-medium hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed">
                        {{ i18n.t('common.save') }}
                    </button>
                    <button type="button" (click)="showGroundTransportModal.set(false)"
                        class="flex-1 px-4 py-3 rounded-xl bg-[var(--color-bg)] border border-[var(--border)] text-[var(--color-text)] font-medium hover:bg-[var(--color-surface)] transition-colors">
                        {{ i18n.t('common.cancel') }}
                    </button>
                </div>
            </form>
        </div>
    </div>



    <!-- Payment Modal -->
    <div *ngIf="isPaymentModalOpen"
        class="fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fadeIn"
        (click)="closePaymentModal()">
        <div class="bg-[var(--color-surface)] w-full max-w-lg mx-4 rounded-2xl shadow-2xl overflow-hidden border border-[var(--border)] max-h-[90vh] flex flex-col"
            (click)="$event.stopPropagation()">

            <!-- Header with Stripe branding -->
            <div class="bg-gradient-to-r from-[#635bff] to-[#7a73ff] px-6 py-5 text-white flex-shrink-0">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <svg class="w-10 h-10" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M13.976 9.15c-2.172-.806-3.356-1.426-3.356-2.409 0-.831.683-1.305 1.901-1.305 2.227 0 4.515.858 6.09 1.631l.89-5.494C18.252.975 15.697 0 12.165 0 9.667 0 7.589.654 6.104 1.872 4.56 3.147 3.757 4.992 3.757 7.218c0 4.039 2.467 5.76 6.476 7.219 2.585.92 3.445 1.574 3.445 2.583 0 .98-.84 1.545-2.354 1.545-1.875 0-4.965-.921-6.99-2.109l-.9 5.555C5.175 22.99 8.385 24 11.714 24c2.641 0 4.843-.624 6.328-1.813 1.664-1.305 2.525-3.236 2.525-5.732 0-4.128-2.524-5.851-6.591-7.305z" />
                        </svg>
                        <div>
                            <h2 class="text-lg font-bold">Secure Payment</h2>
                            <p class="text-sm text-white/80">Powered by Stripe</p>
                        </div>
                    </div>
                    <button (click)="closePaymentModal()" class="text-white/80 hover:text-white transition-colors">
                        <lucide-icon name="x" class="w-6 h-6"></lucide-icon>
                    </button>
                </div>
            </div>

            <!-- Modal Content with Scroll -->
            <div class="p-6 overflow-y-auto flex-1 space-y-6">

                <!-- Booking & Dates Summary -->
                <div class="bg-[var(--color-bg)] rounded-xl p-4 border border-[var(--border)]">
                    <h4 class="font-bold text-[var(--color-text)] mb-3 flex items-center gap-2 text-sm">
                        <lucide-icon name="calendar" class="w-4 h-4 text-[var(--primary)]"></lucide-icon>
                        Booking Details
                    </h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-[var(--color-text-muted)]">Booking ID:</span>
                            <span class="font-mono font-medium text-[var(--color-text)]">#{{
                                selectedBookingForPayment?.bookingNumber
                                || selectedBookingForPayment?.id }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-[var(--color-text-muted)]">Trip Type:</span>
                            <span class="font-medium text-[var(--color-text)]">{{
                                getBookingType(selectedBookingForPayment) }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-[var(--color-text-muted)]">Travel Dates:</span>
                            <span class="font-medium text-[var(--color-text)]">
                                {{ selectedBookingForPayment?.travelStartDate | date:'mediumDate' }} -
                                {{ selectedBookingForPayment?.travelEndDate | date:'mediumDate' }}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Travelers List -->
                <div *ngIf="selectedBookingForPayment?.travelers?.length"
                    class="bg-[var(--color-bg)] rounded-xl p-4 border border-[var(--border)]">
                    <h4 class="font-bold text-[var(--color-text)] mb-3 flex items-center gap-2 text-sm">
                        <lucide-icon name="users" class="w-4 h-4 text-[var(--primary)]"></lucide-icon>
                        Travelers ({{ selectedBookingForPayment?.travelers?.length }})
                    </h4>
                    <ul class="space-y-2">
                        <li *ngFor="let traveler of selectedBookingForPayment?.travelers"
                            class="text-sm flex justify-between items-center p-2 bg-[var(--color-surface)] rounded-lg border border-[var(--border)]">
                            <span class="font-medium text-[var(--color-text)]">{{ traveler.firstName }} {{
                                traveler.lastName }}</span>
                            <span
                                class="text-xs text-[var(--color-text-muted)] bg-[var(--color-bg)] px-2 py-1 rounded-md">{{
                                traveler.nationality }}</span>
                        </li>
                    </ul>
                </div>

                <!-- Detailed Price Breakdown -->
                <div class="bg-[var(--color-bg)] rounded-xl p-4 border border-[var(--border)]">
                    <h4 class="font-bold text-[var(--color-text)] mb-3 flex items-center gap-2 text-sm">
                        <lucide-icon name="receipt" class="w-4 h-4 text-[var(--primary)]"></lucide-icon>
                        Price Breakdown
                    </h4>
                    <div class="space-y-2 text-sm">
                        <!-- Makkah -->
                        <div *ngIf="selectedBookingForPayment?.makkahHotel"
                            class="flex justify-between items-center group">
                            <span class="text-[var(--color-text-muted)] flex items-center gap-2">
                                <lucide-icon name="building-2" class="w-3.5 h-3.5"></lucide-icon>
                                Makkah Hotel
                                <span class="text-xs opacity-60">({{ selectedBookingForPayment?.makkahHotel?.roomType
                                    }})</span>
                            </span>
                            <span class="text-[var(--color-text)] font-medium">{{
                                selectedBookingForPayment?.makkahHotelPrice |
                                currency:'SAR' }}</span>
                        </div>
                        <!-- Madinah -->
                        <div *ngIf="selectedBookingForPayment?.madinahHotel" class="flex justify-between items-center">
                            <span class="text-[var(--color-text-muted)] flex items-center gap-2">
                                <lucide-icon name="building" class="w-3.5 h-3.5"></lucide-icon>
                                Madinah Hotel
                                <span class="text-xs opacity-60">({{ selectedBookingForPayment?.madinahHotel?.roomType
                                    }})</span>
                            </span>
                            <span class="text-[var(--color-text)] font-medium">{{
                                selectedBookingForPayment?.madinahHotelPrice |
                                currency:'SAR' }}</span>
                        </div>
                        <!-- Int Transport -->
                        <div *ngIf="selectedBookingForPayment?.internationalTransport"
                            class="flex justify-between items-center">
                            <span class="text-[var(--color-text-muted)] flex flex-col gap-0.5">
                                <span class="flex items-center gap-2">
                                    <lucide-icon name="plane" class="w-3.5 h-3.5"></lucide-icon>
                                    Flight
                                    <span class="text-xs opacity-60">({{
                                        selectedBookingForPayment?.internationalTransport?.carrierName
                                        }})</span>
                                </span>
                                <span class="text-xs pl-5.5 opacity-75">
                                    GO: {{ selectedBookingForPayment?.internationalTransport?.departureDate |
                                    date:'shortDate' }}
                                    <span *ngIf="selectedBookingForPayment?.internationalTransport?.returnDate">
                                        | BACK: {{ selectedBookingForPayment?.internationalTransport?.returnDate |
                                        date:'shortDate' }}
                                    </span>
                                </span>
                            </span>
                            <span class="text-[var(--color-text)] font-medium">{{
                                selectedBookingForPayment?.internationalTransportPrice | currency:'SAR' }}</span>
                        </div>
                        <!-- Ground Transport -->
                        <div *ngIf="selectedBookingForPayment?.groundTransport"
                            class="flex justify-between items-center">
                            <span class="text-[var(--color-text-muted)] flex items-center gap-2">
                                <lucide-icon name="bus" class="w-3.5 h-3.5"></lucide-icon>
                                Ground Transport
                            </span>
                            <span class="text-[var(--color-text)] font-medium">{{
                                selectedBookingForPayment?.groundTransportPrice |
                                currency:'SAR' }}</span>
                        </div>

                        <div class="border-t border-[var(--border)] my-2 pt-2 space-y-1">
                            <!-- Subtotal -->
                            <div *ngIf="selectedBookingForPayment?.subTotal"
                                class="flex justify-between items-center text-[var(--color-text-muted)]">
                                <span>Subtotal</span>
                                <span>{{ selectedBookingForPayment?.subTotal | currency:'SAR' }}</span>
                            </div>
                            <!-- Tax -->
                            <div *ngIf="selectedBookingForPayment?.taxAmount"
                                class="flex justify-between items-center text-[var(--color-text-muted)]">
                                <span>Tax</span>
                                <span>{{ selectedBookingForPayment?.taxAmount | currency:'SAR' }}</span>
                            </div>
                            <!-- Service Fee -->
                            <div *ngIf="selectedBookingForPayment?.serviceFee"
                                class="flex justify-between items-center text-[var(--color-text-muted)]">
                                <span>Service Fee</span>
                                <span>{{ selectedBookingForPayment?.serviceFee | currency:'SAR' }}</span>
                            </div>
                        </div>

                        <!-- Total -->
                        <div class="flex justify-between items-center pt-2 border-t border-[var(--border)]">
                            <span class="text-[var(--color-text)] font-bold text-base">Total Due</span>
                            <span class="text-2xl font-bold text-[#635bff]">{{ paymentAmount | currency:'SAR' }}</span>
                        </div>
                    </div>
                </div>

                <!-- Card Section -->
                <div class="space-y-3">
                    <label class="text-sm font-medium text-[var(--color-text)] flex items-center gap-2">
                        <lucide-icon name="credit-card" class="w-4 h-4 text-[var(--primary)]"></lucide-icon>
                        Pay with Card
                    </label>

                    <!-- Card Brand Icons -->
                    <div class="flex items-center gap-2 mb-2">
                        <div
                            class="px-2 py-1 bg-gray-100 dark:bg-zinc-800 rounded text-xs font-bold text-blue-700 border border-gray-200 dark:border-zinc-700">
                            VISA</div>
                        <div
                            class="px-2 py-1 bg-gray-100 dark:bg-zinc-800 rounded text-xs font-bold text-orange-600 border border-gray-200 dark:border-zinc-700">
                            Mastercard</div>
                        <div
                            class="px-2 py-1 bg-gray-100 dark:bg-zinc-800 rounded text-xs font-bold text-blue-500 border border-gray-200 dark:border-zinc-700">
                            AMEX</div>
                    </div>

                    <div class="space-y-3">
                        <input id="cardHolderName" type="text" [(ngModel)]="cardHolderName"
                            placeholder="Cardholder Name" aria-label="Cardholder Name"
                            class="w-full px-4 py-3 rounded-xl border border-[var(--border)] bg-[var(--color-bg)] text-[var(--color-text)] focus:ring-2 focus:ring-[#635bff]/20 focus:border-[#635bff] outline-none transition-all placeholder:text-[var(--color-text-muted)]">

                        <div
                            class="p-4 rounded-xl border border-[var(--border)] bg-white dark:bg-zinc-900 focus-within:border-[#635bff] focus-within:ring-2 focus-within:ring-[#635bff]/20 transition-all">
                            <div id="card-element" class="min-h-[24px]"></div>
                        </div>
                    </div>

                    <p *ngIf="cardErrors"
                        class="text-red-500 text-sm mt-2 flex items-center gap-1 bg-red-50 dark:bg-red-900/10 p-2 rounded-lg border border-red-100 dark:border-red-900/30">
                        <lucide-icon name="alert-circle" class="w-4 h-4"></lucide-icon>
                        {{ cardErrors }}
                    </p>

                    <p class="text-xs text-[var(--color-text-muted)] flex items-center gap-1 justify-center mt-2">
                        <lucide-icon name="lock" class="w-3 h-3"></lucide-icon>
                        Payments are 256-bit encrypted and secure
                    </p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="p-6 bg-[var(--color-bg)] border-t border-[var(--border)] sticky bottom-0">
                <button (click)="processPayment()" [disabled]="isProcessingPayment || !stripe || !cardElement"
                    class="w-full py-3.5 px-4 bg-[#635bff] hover:bg-[#534acb] text-white font-semibold rounded-xl shadow-lg shadow-[#635bff]/25 hover:shadow-xl hover:shadow-[#635bff]/30 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2 mb-3">
                    <span *ngIf="isProcessingPayment"
                        class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
                    <lucide-icon *ngIf="!isProcessingPayment" name="lock" class="w-4 h-4"></lucide-icon>
                    <span *ngIf="!isProcessingPayment">Pay {{ paymentAmount | currency:'SAR' }}</span>
                </button>

                <button (click)="closePaymentModal()"
                    class="w-full py-3 px-4 bg-transparent border border-[var(--border)] text-[var(--color-text)] font-medium rounded-xl hover:bg-[var(--color-surface)] transition-all">
                    Cancel
                </button>
            </div>
        </div>
    </div>


    <!-- Booking Details Modal -->
    <div *ngIf="showBookingDetailsModal()"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 overflow-y-auto animate-fadeIn"
        (click)="closeBookingDetailsModal()">
        <div class="bg-[var(--color-surface)] rounded-2xl p-6 max-w-3xl w-full shadow-2xl border border-[var(--border)] my-8 max-h-[90vh] overflow-y-auto"
            (click)="$event.stopPropagation()">

            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-xl bg-[var(--primary)]/10 flex items-center justify-center text-3xl">
                        {{ (selectedBookingDetails()?.type === 'Hajj' || selectedBookingDetails()?.type === '1') ? 'üïã'
                        : 'üïå' }}
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-[var(--color-text)]">{{
                            selectedBookingDetails()?.bookingNumber || '#' +
                            selectedBookingDetails()?.id }}</h3>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="px-2.5 py-1 rounded-full text-xs font-medium border" [ngClass]="{
                'bg-green-50 text-green-700 border-green-200': selectedBookingDetails()?.status === 'Confirmed',
                'bg-yellow-50 text-yellow-700 border-yellow-200': selectedBookingDetails()?.status === 'Pending',
                'bg-red-50 text-red-700 border-red-200': selectedBookingDetails()?.status === 'Cancelled',
                'bg-blue-50 text-blue-700 border-blue-200': selectedBookingDetails()?.status === 'Paid',
                'bg-purple-50 text-purple-700 border-purple-200': selectedBookingDetails()?.status === 'Refunded'
              }">{{ selectedBookingDetails()?.status }}</span>
                            <span
                                class="px-2 py-0.5 rounded-md text-xs bg-gray-100 dark:bg-gray-800 text-[var(--color-text-muted)] border border-[var(--border)]">
                                {{ getBookingType(selectedBookingDetails()) }}
                            </span>
                        </div>
                    </div>
                </div>
                <button (click)="closeBookingDetailsModal()"
                    class="p-2 rounded-xl hover:bg-[var(--color-bg)] transition-colors">
                    <lucide-icon name="x" class="w-6 h-6 text-[var(--color-text-muted)]"></lucide-icon>
                </button>
            </div>

            <!-- Content Grid -->
            <div class="space-y-6">

                <!-- Travel Dates -->
                <div class="bg-[var(--color-bg)] rounded-xl p-4 border border-[var(--border)]">
                    <h4 class="font-semibold text-[var(--color-text)] mb-3 flex items-center gap-2">
                        <span>üìÖ</span> Travel Dates
                    </h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-[var(--color-text-muted)]">Start Date:</span>
                            <p class="font-medium text-[var(--color-text)]">{{ selectedBookingDetails()?.travelStartDate
                                |
                                date:'mediumDate' }}</p>
                        </div>
                        <div>
                            <span class="text-[var(--color-text-muted)]">End Date:</span>
                            <p class="font-medium text-[var(--color-text)]">{{ selectedBookingDetails()?.travelEndDate |
                                date:'mediumDate' }}</p>
                        </div>
                    </div>
                </div>

                <!-- Hotels -->
                <div *ngIf="selectedBookingDetails()?.makkahHotel || selectedBookingDetails()?.madinahHotel"
                    class="bg-[var(--color-bg)] rounded-xl p-4 border border-[var(--border)]">
                    <h4 class="font-semibold text-[var(--color-text)] mb-3 flex items-center gap-2">
                        <span>üè®</span> Hotels
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div *ngIf="selectedBookingDetails()?.makkahHotel"
                            class="p-3 bg-[var(--color-surface)] rounded-lg border border-[var(--border)]">
                            <p class="text-xs text-[var(--color-text-muted)] mb-1">üïã Makkah</p>
                            <p class="font-medium text-[var(--color-text)]">{{
                                selectedBookingDetails()?.makkahHotel?.hotelName ||
                                'Hotel' }}</p>
                            <p class="text-sm text-[var(--color-text-muted)]">{{
                                selectedBookingDetails()?.makkahHotel?.roomType }}
                                Room</p>
                            <div class="mt-2 text-xs text-[var(--color-text-muted)] flex items-center gap-2">
                                <span>üìÖ</span>
                                <span>{{ selectedBookingDetails()?.makkahHotel?.checkInDate | date:'shortDate' }} ‚Üí
                                    {{ selectedBookingDetails()?.makkahHotel?.checkOutDate | date:'shortDate' }}</span>
                            </div>
                            <p class="text-sm font-semibold text-[var(--primary)] mt-1">{{
                                selectedBookingDetails()?.makkahHotel?.totalPrice | currency:'SAR' }}</p>
                        </div>
                        <div *ngIf="selectedBookingDetails()?.madinahHotel"
                            class="p-3 bg-[var(--color-surface)] rounded-lg border border-[var(--border)]">
                            <p class="text-xs text-[var(--color-text-muted)] mb-1">üïå Madinah</p>
                            <p class="font-medium text-[var(--color-text)]">{{
                                selectedBookingDetails()?.madinahHotel?.hotelName ||
                                'Hotel' }}</p>
                            <p class="text-sm text-[var(--color-text-muted)]">{{
                                selectedBookingDetails()?.madinahHotel?.roomType }}
                                Room</p>
                            <div class="mt-2 text-xs text-[var(--color-text-muted)] flex items-center gap-2">
                                <span>üìÖ</span>
                                <span>{{ selectedBookingDetails()?.madinahHotel?.checkInDate | date:'shortDate' }} ‚Üí
                                    {{ selectedBookingDetails()?.madinahHotel?.checkOutDate | date:'shortDate' }}</span>
                            </div>
                            <p class="text-sm font-semibold text-[var(--primary)] mt-1">{{
                                selectedBookingDetails()?.madinahHotel?.totalPrice | currency:'SAR' }}</p>
                        </div>
                    </div>
                </div>

                <!-- Transport -->
                <div *ngIf="selectedBookingDetails()?.internationalTransport || selectedBookingDetails()?.groundTransport"
                    class="bg-[var(--color-bg)] rounded-xl p-4 border border-[var(--border)]">
                    <h4 class="font-semibold text-[var(--color-text)] mb-3 flex items-center gap-2">
                        <span>‚úàÔ∏è</span> Transport
                    </h4>
                    <div class="space-y-3">
                        <div *ngIf="selectedBookingDetails()?.internationalTransport"
                            class="p-3 bg-[var(--color-surface)] rounded-lg border border-[var(--border)]">
                            <div class="flex items-center gap-2 mb-2">
                                <lucide-icon name="plane" class="w-4 h-4 text-blue-500"></lucide-icon>
                                <div>
                                    <p class="text-xs text-[var(--color-text-muted)]">International Flight</p>
                                    <p class="font-medium text-[var(--color-text)]">{{
                                        selectedBookingDetails()?.internationalTransport?.carrierName || 'Flight' }}</p>
                                </div>
                            </div>

                            <div class="space-y-2 text-sm mt-3 border-t border-[var(--border)] pt-2">
                                <!-- GO -->
                                <div>
                                    <div class="flex items-center gap-2 mb-1">
                                        <span
                                            class="px-1.5 py-0.5 bg-[var(--primary)]/10 text-[var(--primary)] text-[10px] font-bold uppercase rounded">GO</span>
                                        <span class="text-[var(--color-text)] font-medium">
                                            {{ selectedBookingDetails()?.internationalTransport?.departureAirport }}
                                            <span class="text-[var(--color-text-muted)] mx-1">‚ûù</span>
                                            {{ selectedBookingDetails()?.internationalTransport?.arrivalAirport }}
                                        </span>
                                    </div>
                                    <div class="text-[var(--color-text-muted)] text-xs pl-9">
                                        üìÖ {{ selectedBookingDetails()?.internationalTransport?.departureDate |
                                        date:'mediumDate' }} ‚Ä¢ {{
                                        selectedBookingDetails()?.internationalTransport?.departureDate |
                                        date:'shortTime' }}
                                    </div>
                                </div>

                                <!-- BACK -->
                                <div *ngIf="selectedBookingDetails()?.internationalTransport?.returnDate">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span
                                            class="px-1.5 py-0.5 bg-orange-100 text-orange-700 text-[10px] font-bold uppercase rounded">BACK</span>
                                        <span class="text-[var(--color-text)] font-medium">
                                            {{ selectedBookingDetails()?.internationalTransport?.arrivalAirport }}
                                            <span class="text-[var(--color-text-muted)] mx-1">‚ûù</span>
                                            {{ selectedBookingDetails()?.internationalTransport?.departureAirport }}
                                        </span>
                                    </div>
                                    <div class="text-[var(--color-text-muted)] text-xs pl-9">
                                        üìÖ {{ selectedBookingDetails()?.internationalTransport?.returnDate |
                                        date:'mediumDate' }} ‚Ä¢ {{
                                        selectedBookingDetails()?.internationalTransport?.returnDate | date:'shortTime'
                                        }}
                                    </div>
                                </div>
                            </div>

                            <p
                                class="text-sm font-semibold text-[var(--primary)] mt-3 pt-2 border-t border-[var(--border)] text-right">
                                {{
                                selectedBookingDetails()?.internationalTransport?.totalPrice | currency:'SAR' }}</p>
                        </div>
                        <div *ngIf="selectedBookingDetails()?.groundTransport"
                            class="p-3 bg-[var(--color-surface)] rounded-lg border border-[var(--border)]">
                            <p class="text-xs text-[var(--color-text-muted)] mb-1">üöê Ground Transport</p>
                            <p class="font-medium text-[var(--color-text)]">{{
                                selectedBookingDetails()?.groundTransport?.serviceName
                                }}</p>
                            <p class="text-sm text-[var(--color-text-muted)]">{{
                                selectedBookingDetails()?.groundTransport?.pickupLocation }} ‚Üí {{
                                selectedBookingDetails()?.groundTransport?.dropoffLocation }}</p>
                            <div *ngIf="selectedBookingDetails()?.groundTransport?.serviceDate"
                                class="mt-2 text-xs text-[var(--color-text-muted)] flex items-center gap-2">
                                <span>üìÖ</span>
                                <span>{{ selectedBookingDetails()?.groundTransport?.serviceDate | date:'shortDate'
                                    }}</span>
                            </div>
                            <p class="text-sm font-semibold text-[var(--primary)] mt-1">{{
                                selectedBookingDetails()?.groundTransport?.totalPrice | currency:'SAR' }}</p>
                        </div>
                    </div>
                </div>

                <!-- Travelers -->
                <div *ngIf="selectedBookingDetails()?.travelers?.length"
                    class="bg-[var(--color-bg)] rounded-xl p-4 border border-[var(--border)]">
                    <h4 class="font-semibold text-[var(--color-text)] mb-3 flex items-center gap-2">
                        <span>üë•</span> Travelers ({{ selectedBookingDetails()?.travelers?.length }})
                        <span *ngIf="selectedBookingDetails()?.status === 'Confirmed'"
                            class="ml-auto text-xs text-green-600 bg-green-50 px-2 py-0.5 rounded-full">
                            üìÑ Documents Available
                        </span>
                    </h4>
                    <div class="space-y-2">
                        <div *ngFor="let traveler of selectedBookingDetails()?.travelers; let i = index; trackBy: trackByIndex"
                            class="p-3 bg-[var(--color-surface)] rounded-lg border border-[var(--border)] flex items-center gap-3 flex-wrap">
                            <div
                                class="w-10 h-10 rounded-full bg-[var(--primary)]/10 flex items-center justify-center text-[var(--primary)] font-bold">
                                {{ (traveler.firstName || '').charAt(0) }}{{ (traveler.lastName || '').charAt(0) }}
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="font-medium text-[var(--color-text)]">{{ traveler.firstName }} {{
                                    traveler.lastName }}</p>
                                <p class="text-xs text-[var(--color-text-muted)] truncate">{{ traveler.email }} ‚Ä¢ {{
                                    traveler.nationality }}</p>
                            </div>
                            <span *ngIf="traveler.isMainTraveler"
                                class="px-2 py-0.5 text-xs bg-[var(--primary)]/10 text-[var(--primary)] rounded-full">Main</span>

                            <!-- Document Download Buttons (Strictly for Confirmed bookings) -->
                            <div *ngIf="selectedBookingDetails()?.status === 'Confirmed'"
                                class="flex gap-2 w-full sm:w-auto mt-2 sm:mt-0">
                                <button
                                    (click)="downloadDocument(selectedBookingDetails()!, traveler, 'visa'); $event.stopPropagation()"
                                    class="flex-1 sm:flex-none px-3 py-1.5 text-xs bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors flex items-center justify-center gap-1.5 border border-blue-100 font-medium">
                                    <span>üìÑ</span> Visa
                                </button>
                                <button
                                    (click)="downloadDocument(selectedBookingDetails()!, traveler, 'ticket'); $event.stopPropagation()"
                                    class="flex-1 sm:flex-none px-3 py-1.5 text-xs bg-green-50 text-green-600 rounded-lg hover:bg-green-100 transition-colors flex items-center justify-center gap-1.5 border border-green-100 font-medium">
                                    <span>üé´</span> Ticket
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Price Summary -->
                <div
                    class="bg-gradient-to-r from-[var(--primary)]/10 to-purple-500/10 rounded-xl p-4 border border-[var(--primary)]/20">
                    <h4 class="font-semibold text-[var(--color-text)] mb-3 flex items-center gap-2">
                        <span>üí∞</span> Price Summary
                    </h4>
                    <div class="space-y-2 text-sm">
                        <div *ngIf="selectedBookingDetails()?.subTotal" class="flex justify-between">
                            <span class="text-[var(--color-text-muted)]">Subtotal</span>
                            <span class="text-[var(--color-text)]">{{ selectedBookingDetails()?.subTotal |
                                currency:'SAR' }}</span>
                        </div>
                        <div *ngIf="selectedBookingDetails()?.taxAmount" class="flex justify-between">
                            <span class="text-[var(--color-text-muted)]">Tax</span>
                            <span class="text-[var(--color-text)]">{{ selectedBookingDetails()?.taxAmount |
                                currency:'SAR' }}</span>
                        </div>
                        <div *ngIf="selectedBookingDetails()?.serviceFee" class="flex justify-between">
                            <span class="text-[var(--color-text-muted)]">Service Fee</span>
                            <span class="text-[var(--color-text)]">{{ selectedBookingDetails()?.serviceFee |
                                currency:'SAR' }}</span>
                        </div>
                        <hr class="border-[var(--border)]">
                        <div class="flex justify-between text-lg font-bold">
                            <span class="text-[var(--color-text)]">Total</span>
                            <span class="text-[var(--primary)]">{{ selectedBookingDetails()?.totalPrice | currency:'SAR'
                                }}</span>
                        </div>
                    </div>
                </div>

                <!-- Created Date -->
                <div class="text-center text-sm text-[var(--color-text-muted)]">
                    Booked on {{ selectedBookingDetails()?.createdAt | date:'medium' }}
                </div>
            </div>

            <!-- DEBUG: Raw JSON View (Remove in production) -->
            <div class="mt-4 p-4 bg-gray-100 rounded-xl border border-gray-300 overflow-x-auto text-xs font-mono"
                *ngIf="selectedBookingDetails()?.internationalTransport">
                <details>
                    <summary class="cursor-pointer font-bold text-gray-700">Debug: Raw Transport Data</summary>
                    <pre class="mt-2 text-gray-600">{{ selectedBookingDetails()?.internationalTransport | json }}</pre>
                </details>
            </div>

            <!-- Footer -->
            <div class="mt-6 pt-4 border-t border-[var(--border)] flex justify-end">
                <button (click)="closeBookingDetailsModal()"
                    class="px-6 py-2.5 rounded-xl bg-[var(--primary)] text-white font-medium hover:opacity-90 transition-opacity">
                    Close
                </button>
            </div>
        </div>
    </div>


    <!-- Broadcast Modal -->
    <div *ngIf="showBroadcastModal()"
        class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div
            class="bg-white rounded-2xl shadow-xl w-full max-w-2xl overflow-hidden animate-in fade-in zoom-in duration-200">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                <h3 class="text-xl font-bold text-gray-900 flex items-center gap-2">
                    <lucide-icon name="mail" class="text-blue-600"></lucide-icon>
                    Send Newsletter Broadcast
                </h3>
                <button (click)="closeBroadcastModal()"
                    class="text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-full">
                    <lucide-icon name="x" [size]="20"></lucide-icon>
                </button>
            </div>

            <div class="p-6 space-y-6">
                <div class="space-y-2">
                    <label for="broadcastSubject" class="block text-sm font-medium text-gray-700">Subject Line</label>
                    <input id="broadcastSubject" type="text" [ngModel]="broadcastSubject()"
                        (ngModelChange)="broadcastSubject.set($event)"
                        class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all outline-none text-gray-900"
                        placeholder="e.g., Special Offer for Hajj 2025">
                </div>

                <div class="space-y-2">
                    <label for="broadcastBody" class="block text-sm font-medium text-gray-700">Email Body (HTML
                        supported)</label>
                    <textarea id="broadcastBody" [ngModel]="broadcastBody()" (ngModelChange)="broadcastBody.set($event)"
                        rows="8"
                        class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all outline-none font-mono text-sm text-gray-900"
                        placeholder="<p>Dear Valued Customer...</p>"></textarea>
                    <p class="text-xs text-gray-500">You can use basic HTML tags for formatting.</p>
                </div>

                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex gap-3">
                    <lucide-icon name="alert-circle" class="text-yellow-600 shrink-0" [size]="20"></lucide-icon>
                    <div class="text-sm text-yellow-800">
                        <strong>Warning:</strong> This will send an email to ALL registered users and subscribers. This
                        action
                        cannot
                        be undone.
                    </div>
                </div>
            </div>

            <div class="p-6 border-t border-gray-100 bg-gray-50 flex justify-end gap-3">
                <button (click)="closeBroadcastModal()"
                    class="px-6 py-2.5 rounded-xl border border-gray-200 text-gray-700 font-medium hover:bg-gray-100 transition-colors">
                    Cancel
                </button>
                <button (click)="sendBroadcast()" [disabled]="isSendingBroadcast()"
                    class="px-6 py-2.5 rounded-xl bg-blue-600 text-white font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg shadow-blue-600/20 flex items-center gap-2">
                    <lucide-icon *ngIf="isSendingBroadcast()" name="refresh-cw" class="animate-spin"
                        [size]="18"></lucide-icon>
                    {{ isSendingBroadcast() ? 'Sending...' : 'Send Broadcast' }}
                </button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div *ngIf="showDeleteConfirmModal()"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fadeIn"
        (click)="cancelDelete()">
        <div class="bg-[var(--color-surface)] rounded-2xl p-8 max-w-md w-full shadow-2xl border border-[var(--border)] transform transition-all scale-100"
            (click)="$event.stopPropagation()">

            <!-- Warning Icon -->
            <div class="flex justify-center mb-6">
                <div class="w-20 h-20 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
                    <svg class="w-10 h-10 text-red-600 dark:text-red-400" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>
            </div>

            <!-- Title -->
            <h3 class="text-2xl font-bold mb-3 text-center text-[var(--color-text)]">
                {{ deleteConfirmConfig().title }}
            </h3>

            <!-- Message -->
            <p class="text-[var(--color-text-muted)] text-center mb-8 leading-relaxed">
                {{ deleteConfirmConfig().message }}
            </p>

            <!-- Buttons -->
            <div class="flex gap-3">
                <button (click)="cancelDelete()"
                    class="flex-1 px-4 py-3.5 rounded-xl bg-[var(--color-bg)] border border-[var(--border)] font-semibold hover:bg-[var(--color-surface)] transition-all duration-200 text-[var(--color-text)]">
                    Cancel
                </button>
                <button (click)="confirmDelete()"
                    class="flex-1 px-4 py-3.5 rounded-xl bg-gradient-to-r from-red-500 to-red-600 text-white font-semibold hover:from-red-600 hover:to-red-700 transition-all duration-200 shadow-lg shadow-red-500/30">
                    Delete
                </button>
            </div>
        </div>
    </div>