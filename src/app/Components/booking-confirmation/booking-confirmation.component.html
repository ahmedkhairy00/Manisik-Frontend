<section
  class="min-h-screen bg-gray-50 dark:bg-zinc-950 flex flex-col items-center justify-center p-6 print:bg-white print:p-0">

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center space-y-4 print:hidden">
    <div class="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"></div>
    <h1 class="text-xl font-medium text-gray-600 dark:text-gray-300">Generating Receipt...</h1>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && !booking"
    class="text-center space-y-6 max-w-md w-full p-8 bg-white dark:bg-zinc-900 rounded-3xl shadow-xl animate-fadeIn">
    <div
      class="w-20 h-20 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-full flex items-center justify-center mx-auto mb-4">
      <span class="text-4xl font-bold">!</span>
    </div>
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Receipt Not Found</h2>
    <p class="text-gray-500 dark:text-gray-400">
      We couldn't find the booking details. This might be because the payment is still processing or the ID is
      incorrect.
    </p>
    <div class="flex flex-col gap-3">
      <button (click)="goHome()"
        class="w-full px-6 py-3 bg-gray-100 dark:bg-zinc-800 text-gray-900 dark:text-white font-semibold rounded-xl hover:bg-gray-200 dark:hover:bg-zinc-700 transition-all">
        Go Home
      </button>
      <button (click)="goToDashboard()"
        class="w-full px-6 py-3 bg-blue-600 text-white font-semibold rounded-xl shadow-lg shadow-blue-600/20 hover:bg-blue-700 transition-all">
        Go to Dashboard
      </button>
    </div>
  </div>

  <!-- Receipt Card -->
  <div *ngIf="!isLoading && booking" id="receipt-container"
    class="max-w-3xl w-full bg-white dark:bg-zinc-900 shadow-2xl rounded-3xl overflow-hidden print:shadow-none print:w-full print:max-w-none print:rounded-none flex flex-col h-auto print:text-black">

    <!-- Receipt Header -->
    <div
      class="bg-gradient-to-r from-blue-600 to-indigo-700 p-8 text-white text-center print:bg-white print:text-black print:border-b-2 print:border-gray-200 print:mb-4">
      <div
        class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm print:hidden">
        <span class="text-3xl">‚úì</span>
      </div>
      <!-- Logo for Print (Optional placeholder if no logo asset) -->
      <div class="hidden print:block text-4xl font-bold text-blue-600 mb-4">Manasik</div>

      <h1 class="text-3xl font-bold mb-2 print:text-5xl">Payment Receipt</h1>
      <p class="text-blue-100 print:text-gray-600 print:text-xl">Thank you for your booking</p>
    </div>

    <!-- Receipt Body -->
    <div class="p-8 space-y-8 flex-grow">

      <!-- Customer & Booking Info -->
      <div class="grid grid-cols-2 gap-8 pb-8 border-b border-dashed border-gray-200 dark:border-zinc-800">
        <div>
          <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1 print:text-gray-600">Customer
            Details</p>
          <div class="text-gray-900 dark:text-white font-medium print:text-black">
            <p class="text-lg" *ngIf="booking.travelers?.[0]">{{ booking.travelers?.[0]?.firstName }} {{
              booking.travelers?.[0]?.lastName }}
            </p>
            <p class="text-lg" *ngIf="!booking.travelers?.[0] && currentUser">{{ currentUser.fullName }}</p>
            <p class="text-sm text-gray-500 break-all print:text-gray-700" *ngIf="booking.travelers?.[0]">{{
              booking.travelers?.[0]?.email
              }}
            </p>
            <p class="text-sm text-gray-500 break-all print:text-gray-700"
              *ngIf="!booking.travelers?.[0] && currentUser">{{
              currentUser.email }}
            </p>
          </div>
        </div>
        <div class="text-right">
          <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1 print:text-gray-600">Booking
            Reference</p>
          <p class="text-2xl font-mono font-bold text-gray-900 dark:text-white print:text-black">{{
            booking.bookingNumber || '#' +
            booking.id }}</p>
          <p class="text-sm text-gray-500 mt-1 print:text-gray-700">Date: {{ (booking.paymentDate || booking.updatedAt)
            | date:'medium'
            }}</p>
          <p class="text-sm text-purple-600 dark:text-purple-400 mt-1 font-semibold print:text-gray-800"
            *ngIf="booking.type !== undefined">
            Trip Type: {{ (booking.type === '1' || booking.type === 'Hajj' || booking.type.toString().toLowerCase()
            ===
            'hajj') ? 'Hajj ‚ú®' :
            'Umrah üïã' }}
          </p>
          <p class="text-sm text-blue-600 mt-1 font-medium print:text-gray-800" *ngIf="booking.travelStartDate">
            Trip: {{ booking.travelStartDate | date:'mediumDate' }}
            <span *ngIf="booking.travelEndDate"> - {{ booking.travelEndDate | date:'mediumDate' }}</span>
          </p>
        </div>
      </div>

      <!-- Payment Method & Transaction -->
      <div class="grid grid-cols-2 gap-8 pb-8 border-b border-dashed border-gray-200 dark:border-zinc-800">
        <div>
          <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1 print:text-gray-600">Payment
            Method</p>
          <div class="flex items-center gap-2">
            <span
              class="px-2 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-sm font-bold print:border print:border-gray-300 print:text-black print:bg-gray-100">STRIPE</span>
            <span class="text-gray-400 text-sm print:text-gray-600">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242</span>
          </div>
        </div>
        <div class="text-right">
          <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-1 print:text-gray-600">Transaction
            ID</p>
          <p class="text-sm font-mono text-gray-500 break-all print:text-gray-700">{{ paymentIntentId ||
            booking.payment?.paymentIntentId ||
            booking.payment?.id || 'N/A' }}</p>
        </div>
      </div>


      <!-- Itemized Breakdown -->
      <div>
        <h3 class="text-sm font-bold text-gray-900 dark:text-white uppercase tracking-wider mb-4 print:text-black">
          Detailed Breakdown
        </h3>
        <div
          class="bg-gray-50 dark:bg-zinc-800/50 rounded-lg p-6 space-y-4 print:bg-white print:p-0 print:border print:border-gray-200">

          <!-- Makkah Hotel -->
          <div *ngIf="booking.makkahHotelId"
            class="flex justify-between text-sm text-gray-700 dark:text-gray-300 print:text-black">
            <div class="flex flex-col">
              <span class="font-medium print:text-black">Makkah Hotel Accommodation</span>
              <span class="text-xs text-gray-500 print:text-gray-600" *ngIf="booking.makkahHotel?.checkInDate">
                Check-in: {{ booking.makkahHotel?.checkInDate | date:'mediumDate' }}
              </span>
              <span class="text-xs text-gray-500 print:text-gray-600" *ngIf="booking.makkahHotel?.checkOutDate">
                Check-out: {{ booking.makkahHotel?.checkOutDate | date:'mediumDate' }}
              </span>
              <span class="text-xs text-gray-500 print:text-gray-600" *ngIf="booking.makkahHotel?.numberOfRooms">
                Rooms: {{ booking.makkahHotel?.numberOfRooms }}
              </span>
            </div>
            <span class="font-medium print:text-black">{{ booking.makkahHotelPrice || 0 | currency:'SAR' }}</span>
          </div>

          <!-- Madinah Hotel -->
          <div *ngIf="booking.madinahHotelId"
            class="flex justify-between text-sm text-gray-700 dark:text-gray-300 print:text-black">
            <div class="flex flex-col">
              <span class="font-medium print:text-black">Madinah Hotel Accommodation</span>
              <span class="text-xs text-gray-500 print:text-gray-600" *ngIf="booking.madinahHotel?.checkInDate">
                Check-in: {{ booking.madinahHotel?.checkInDate | date:'mediumDate' }}
              </span>
              <span class="text-xs text-gray-500 print:text-gray-600" *ngIf="booking.madinahHotel?.checkOutDate">
                Check-out: {{ booking.madinahHotel?.checkOutDate | date:'mediumDate' }}
              </span>
              <span class="text-xs text-gray-500 print:text-gray-600" *ngIf="booking.madinahHotel?.numberOfRooms">
                Rooms: {{ booking.madinahHotel?.numberOfRooms }}
              </span>
            </div>
            <span class="font-medium print:text-black">{{ booking.madinahHotelPrice || 0 | currency:'SAR' }}</span>
          </div>

          <!-- International Flight -->
          <div *ngIf="booking.internationalTransportId"
            class="flex justify-between text-sm text-gray-700 dark:text-gray-300 print:text-black">
            <div class="flex flex-col">
              <span class="font-medium print:text-black">International Flight</span>
              <span class="text-xs text-gray-500 print:text-gray-600"
                *ngIf="booking.internationalTransport?.departureDate">
                Departure: {{ booking.internationalTransport?.departureDate | date:'medium' }}
              </span>
              <span class="text-xs text-gray-500 print:text-gray-600"
                *ngIf="booking.internationalTransport?.returnDate">
                Return: {{ booking.internationalTransport?.returnDate | date:'medium' }}
              </span>
              <span class="text-xs text-gray-500 print:text-gray-600"
                *ngIf="booking.internationalTransport?.arrivalDate">
                Arrival: {{ booking.internationalTransport?.arrivalDate | date:'medium' }}
              </span>
              <span class="text-xs text-gray-500 print:text-gray-600"
                *ngIf="booking.internationalTransport?.carrierName">
                Carrier: {{ booking.internationalTransport?.carrierName }}
              </span>
            </div>
            <span class="font-medium print:text-black">{{ booking.internationalTransportPrice || 0 | currency:'SAR'
              }}</span>
          </div>

          <!-- Ground Transport -->
          <div *ngIf="booking.groundTransportId"
            class="flex justify-between text-sm text-gray-700 dark:text-gray-300 print:text-black">
            <div class="flex flex-col">
              <span class="font-medium print:text-black">Ground Transportation</span>
              <span class="text-xs text-gray-500 print:text-gray-600" *ngIf="booking.groundTransport?.serviceDate">
                Service Date: {{ booking.groundTransport?.serviceDate | date:'mediumDate' }}
              </span>
              <span class="text-xs text-gray-500 print:text-gray-600" *ngIf="booking.groundTransport?.serviceName">
                Service: {{ booking.groundTransport?.serviceName }}
              </span>
            </div>
            <span class="font-medium print:text-black">{{ booking.groundTransportPrice || 0 | currency:'SAR' }}</span>
          </div>

          <div
            class="border-t border-gray-200 dark:border-zinc-700 pt-2 flex justify-between text-sm text-gray-600 dark:text-gray-400 print:text-gray-700">
            <span>Service Fees & Taxes (5%)</span>
            <span>{{ booking.serviceFee || ((booking.totalPrice || 0) * 0.05) | currency:'SAR' }}</span>
          </div>

          <!-- Total -->
          <div class="pt-4 border-t-2 border-gray-200 dark:border-zinc-700 flex justify-between items-end mt-2">
            <span class="text-lg font-bold text-gray-900 dark:text-white print:text-black">Amount Paid</span>
            <span class="text-2xl font-bold text-green-600 dark:text-green-400 print:text-black">{{ booking.totalPrice
              || 0 |
              currency:'SAR' }}</span>
          </div>

        </div>
      </div>

      <!-- Footer Info -->
      <div
        class="bg-gray-50 dark:bg-zinc-800/50 -mx-8 -mb-8 p-6 text-center text-sm text-gray-500 border-t border-gray-100 dark:border-zinc-800 print:bg-white print:border-none print:mt-8">
        <p>A confirmation email has been sent to <span
            class="font-medium text-gray-900 dark:text-gray-300 print:text-black">{{
            booking.travelers?.[0]?.email || currentUser?.email || 'your email' }}</span>.</p>
        <p class="mt-1 print:hidden">Need help? Contact support at <a href="mailto:support&#64;manisik.com"
            class="text-blue-600 hover:underline">support&#64;manisik.com</a></p>
        <p class="hidden print:block mt-4 text-xs text-gray-400">Manasik Inc. ‚Ä¢ 123 Travel Way, World ‚Ä¢
          support&#64;manisik.com</p>
      </div>

    </div>
  </div>

  <!-- Actions (Hidden in Print) -->
  <div *ngIf="!isLoading && booking" class="mt-8 flex gap-4 print:hidden">
    <button (click)="downloadReceipt()"
      class="px-6 py-3 bg-white dark:bg-zinc-800 text-gray-900 dark:text-white font-semibold rounded-xl shadow-lg hover:bg-gray-50 dark:hover:bg-zinc-700 transition-all flex items-center gap-2">
      <span class="text-xl">üñ®Ô∏è</span> Print / Download Receipt
    </button>
    <button (click)="goToDashboard()"
      class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-xl shadow-lg shadow-blue-600/20 hover:bg-blue-700 transition-all flex items-center gap-2">
      Go to Dashboard <span>‚Üí</span>
    </button>
  </div>

</section>