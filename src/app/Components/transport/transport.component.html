<!-- Toolbar -->
<div class="bg-(--primary) text-white py-16  my-8 shadow-none transition-colors duration-300 mt-14">
  <div class="w-full max-w-[1150px] mx-auto px-6">
    <div class="text-left">
      <h1 class="text-4xl font-bold mb-1">{{ i18n.translate('transport.title') }}</h1>
      <p class="text-sm opacity-90">{{ i18n.translate('transport.subtitle') }}</p>
    </div>
  </div>
</div>

<!-- Pending Bookings Alerts -->
<section *ngIf="pendingTransportBooking || pendingGroundBooking"
  class="container mx-auto px-6 max-w-[1200px] section-spacing">
  <div *ngIf="pendingTransportBooking" class="mb-4">
    <div
      class="bg-(--color-surface) border-l-4 border-(--primary) p-4 rounded-md shadow-sm flex items-start justify-between gap-4">
      <div class="flex items-start gap-3">
        <lucide-icon name="check-circle" class="w-4 h-4 text-(--primary) mt-1"></lucide-icon>
        <div>
          <p class="text-sm font-semibold text-(--color-text)">{{
            i18n.translate('transport.pending.international.title') || 'Active Flight Booking' }}</p>
          <p class="text-xs text-(--color-text-muted) mt-1">{{ i18n.translate('transport.pending.international') || 'You
            have requested a flight. It is currently pending completion.' }}</p>
        </div>
      </div>
      <div class="flex items-center">
        <button class="btn-secondary" (click)="discardTransportDraft()"
          [attr.aria-label]="i18n.translate('common.delete')">
          {{ i18n.translate('common.delete') }}
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="pendingGroundBooking" class="mb-4">
    <div
      class="bg-(--color-surface) border-l-4 border-(--primary) p-4 rounded-md shadow-sm flex items-start justify-between gap-4">
      <div class="flex items-start gap-3">
        <lucide-icon name="check-circle" class="w-4 h-4 text-(--primary) mt-1"></lucide-icon>
        <div>
          <p class="text-sm font-semibold text-(--color-text)">{{ i18n.translate('transport.pending.ground.title') ||
            'Active Ground Transport Booking' }}</p>
          <p class="text-xs text-(--color-text-muted) mt-1">{{ i18n.translate('transport.pending.ground') || 'You have
            requested a ground transport. It is currently pending completion.' }}</p>
        </div>
      </div>
      <div class="flex items-center">
        <button class="btn-secondary" (click)="discardGroundDraft()"
          [attr.aria-label]="i18n.translate('common.delete')">
          {{ i18n.translate('common.delete') }}
        </button>
      </div>
    </div>
  </div>
</section>

<!-- International Transport -->
<div class="container mx-auto px-6 max-w-[1200px] mt-8 section-spacing">
  <h1 class="text-3xl font-bold mb-3">{{ i18n.translate('transport.international.title') }}</h1>

  <!-- Tabs -->
  <div class="flex gap-2 mb-8 flex-wrap">
    <button class="flex items-center gap-2 px-6 py-3 rounded shadow transition-all duration-300"
      [ngClass]="activeInternationalFilter === 'All' ? 'bg-(--primary) text-white' : 'bg-(--color-surface) text-(--color-text-muted) hover:bg-(--color-bg) hover:text-(--color-text)'"
      (click)="setTransportType('All')">
      <lucide-icon name="layout-grid" class="w-4 h-4"></lucide-icon> {{ i18n.translate('common.all') }}
    </button>
    <button class="flex items-center gap-2 px-6 py-3 rounded shadow transition-all duration-300"
      [ngClass]="activeInternationalFilter === 'Plane' ? 'bg-(--primary) text-white' : 'bg-(--color-surface) text-(--color-text-muted) hover:bg-(--color-bg) hover:text-(--color-text)'"
      (click)="setTransportType('Plane')">
      <lucide-icon name="plane" class="w-4 h-4"></lucide-icon> {{ i18n.translate('transport.international.air') }}
    </button>
    <button class="flex items-center gap-2 px-6 py-3 rounded shadow transition-all duration-300"
      [ngClass]="activeInternationalFilter === 'Ship' ? 'bg-(--primary) text-white' : 'bg-(--color-surface) text-(--color-text-muted) hover:bg-(--color-bg) hover:text-(--color-text)'"
      (click)="setTransportType('Ship')">
      <lucide-icon name="ship" class="w-4 h-4"></lucide-icon> {{ i18n.translate('transport.international.sea') }}
    </button>
  </div>

  <!-- Search Form -->
  <div class="card mb-6">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end form-spacing">
      <div class="flex flex-col">
        <label class="text-xs text-(--color-text-muted) mb-2 uppercase font-semibold">{{
          i18n.translate('transport.search.from') }}</label>
        <select [(ngModel)]="searchParams.departureLocation"
          class="px-4 py-3 border border-(--border) rounded bg-(--color-bg) text-(--color-text) focus:border-(--primary) focus:ring-(--primary) outline-none transition-colors"
          ngDefaultControl required>
          <option value="" disabled selected>{{ i18n.translate('transport.search.fromPlaceholder') }}</option>
          <option *ngFor="let departureAirport of departureAirports"
            [value]="departureAirport.label || departureAirport.key">
            {{ departureAirport.label || departureAirport.key }}
          </option>
        </select>
      </div>

      <!-- To -->
      <div class="flex flex-col">
        <label class="text-xs text-(--color-text-muted) mb-2 uppercase font-semibold">{{
          i18n.translate('transport.search.to') }}</label>
        <select [(ngModel)]="searchParams.arrivalLocation"
          class="px-4 py-3 border border-(--border) rounded bg-(--color-bg) text-(--color-text) focus:border-(--primary) focus:ring-(--primary) outline-none transition-colors"
          required>
          <option value="" disabled selected>{{ i18n.translate('transport.search.to') }}</option>
          <option *ngFor="let arrivalAirport of arrivalAirports" [value]="arrivalAirport.label || arrivalAirport.key">
            {{ arrivalAirport.label || arrivalAirport.key }}
          </option>
        </select>
      </div>
      <div class="flex flex-col">
        <label class="text-xs text-[var(--color-text-muted)] mb-2 uppercase font-semibold">{{
          i18n.translate('transport.search.departureDateTime') || i18n.translate('transport.search.departure') ||
          'Departure Date' }}</label>
        <input type="date" [(ngModel)]="searchParams.departureDate"
          class="px-4 py-3 border border-[var(--border)] rounded bg-[var(--color-bg)] text-[var(--color-text)] focus:border-[var(--primary)] focus:ring-[var(--primary)] outline-none transition-colors">
      </div>
      <div class="flex flex-col">
        <label class="text-xs text-[var(--color-text-muted)] mb-2 uppercase font-semibold">{{
          i18n.translate('transport.search.returnDateTime') || i18n.translate('booking.checkOut') || 'Return Date'
          }}</label>
        <input type="date" [(ngModel)]="searchParams.returnDate"
          class="px-4 py-3 border border-[var(--border)] rounded bg-[var(--color-bg)] text-[var(--color-text)] focus:border-[var(--primary)] focus:ring-[var(--primary)] outline-none transition-colors">
      </div>
      <div>
        <button class="btn-primary" (click)="searchflight()">{{ i18n.translate('transport.search.button') }}</button>
      </div>
    </div>
  </div>

  <div *ngIf="errorMessage" class="text-red-500 bg-[var(--color-surface)] border border-red-500 p-4 rounded mb-4">{{
    errorMessage }}
  </div>

  <!-- Flight Cards -->
  <div *ngFor="let flight of flights"
    class="card grid grid-cols-1 md:grid-cols-[72px_1fr_auto] gap-4 items-center animate-fade-in mb-4">
    <div
      class="flex items-center justify-center w-16 h-16 bg-[var(--color-bg)] rounded-full border border-[var(--border)] text-xl font-bold">
      {{ (flight.carrierName || '').substring(0,2) }}</div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <div>
        <h3 class="text-lg font-semibold">{{ flight.carrierName }}</h3>

        <!-- GO TRIP -->
        <div class="text-sm text-[var(--color-text-muted)] mt-2 bg-[var(--color-bg-secondary)] p-2 rounded">
          <div class="flex items-center gap-2 mb-1">
            <span
              class="font-bold text-[var(--primary)] bg-[var(--primary)] text-white text-xs px-2 py-0.5 rounded">GO</span>
            <span class="font-medium">{{ flight.departureAirport }}</span>
            <lucide-icon name="arrow-right" class="w-3 h-3 text-[var(--color-text-muted)]"></lucide-icon>
            <span class="font-medium">{{ flight.arrivalAirport }}</span>
          </div>
          <div class="text-xs font-medium flex items-center gap-2 mt-1">
            <lucide-icon name="plane-takeoff" class="w-3 h-3"></lucide-icon>
            <span>{{ flight.departureDate | date:'mediumDate' }}</span>
            <span class="text-[var(--primary)] font-bold">{{ flight.departureDate | date:'shortTime' }}</span>

            <span class="mx-1 text-[var(--color-text-muted)]">-</span>

            <lucide-icon name="plane-landing" class="w-3 h-3"></lucide-icon>
            <span class="text-[var(--primary)] font-bold">{{ flight.arrivalDate | date:'shortTime' }}</span>
            <span *ngIf="(flight.arrivalDate | date:'mediumDate') !== (flight.departureDate | date:'mediumDate')"
              class="text-[var(--color-text-muted)] text-[10px]">({{ flight.arrivalDate | date:'mediumDate' }})</span>
          </div>
        </div>

        <!-- RETURN TRIP (BACK) -->
        <div class="text-sm text-[var(--color-text-muted)] mt-2 p-2 rounded border border-[var(--border)]"
          *ngIf="flight.returnDate">
          <div class="flex items-center gap-2 mb-1">
            <span
              class="font-bold text-[var(--color-text-muted)] border border-[var(--color-text-muted)] text-[var(--color-text-muted)] text-xs px-2 py-0.5 rounded">BACK</span>
            <span class="font-medium">{{ flight.arrivalAirport }}</span>
            <lucide-icon name="arrow-right" class="w-3 h-3 text-[var(--color-text-muted)]"></lucide-icon>
            <span class="font-medium">{{ flight.departureAirport }}</span>
          </div>
          <div class="text-xs font-medium flex items-center gap-2 mt-1">
            <lucide-icon name="calendar" class="w-3 h-3"></lucide-icon>
            <span>{{ flight.returnDate | date:'mediumDate' }}</span>
            <span class="text-[var(--primary)] font-bold">{{ flight.returnDate | date:'shortTime' }}</span>
          </div>
        </div>

        <div class="flex items-center gap-2 text-[var(--color-text-muted)] text-sm mt-3">
          <lucide-icon name="star" class="w-3 h-3 text-yellow-500"></lucide-icon>
          <strong>4.8</strong>
          <span class="text-xs">(2340 {{ i18n.translate('transport.reviews') }})</span>
        </div>
      </div>

      <div class="text-sm">
        <div class="text-xs text-[var(--color-text-muted)] uppercase font-semibold">{{
          i18n.translate('transport.flight.duration') }}</div>
        <div class="font-medium mt-1 flex items-center gap-2">
          <lucide-icon name="clock" class="w-4 h-4"></lucide-icon>
          <span *ngIf="flight.duration">{{ flight.duration }}</span>
          <span *ngIf="!flight.duration && flight.departureDate && flight.arrivalDate">{{
            (getDurationInHours(flight.departureDate, flight.arrivalDate) | number:'1.0-1') + 'h' }}</span>
        </div>
        <div class="mt-2">
          <div class="text-xs text-[var(--color-text-muted)] uppercase font-semibold">{{
            i18n.translate('transport.flight.class') }}</div>
          <div class="font-medium">{{ flight.flightClass }}</div>
        </div>
      </div>
    </div>

    <div class="price-section text-right">
      <div class="text-2xl font-bold text-[var(--primary)]">{{ flight.price | currency:'SAR':'symbol':'1.0-0' }}</div>
      <ul class="text-sm text-[var(--color-text-muted)] mt-2 mb-3">
        <li class="flex items-center gap-2 justify-end"><span
            class="material-icons text-[var(--primary)]">check</span>{{
          i18n.translate('transport.flight.meals') }}</li>
        <li class="flex items-center gap-2 justify-end"><span
            class="material-icons text-[var(--primary)]">check</span>30kg
          {{ i18n.translate('transport.flight.baggage') }}</li>
      </ul>
      <button class="btn-primary" (click)="bookFlight(flight)">{{ i18n.translate('transport.book.button') }}</button>
    </div>
  </div>

  <!-- Ground Transport -->
  <div id="ground-transport-section" class="container mx-auto px-6 max-w-[1200px] mt-16 mb-20 section-spacing">
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-(--color-text) mb-2">{{ i18n.translate('transport.domestic.title') }}</h1>
      <p class="text-(--color-text-muted) text-sm">{{ i18n.translate('transport.domestic.subtitle') }}</p>
    </div>

    <!-- Tabs -->
    <div class="flex gap-2 mb-8 flex-wrap">
      <button class="flex items-center gap-2 px-6 py-3 rounded shadow transition-all duration-300"
        [ngClass]="activeGroundFilter === 'All' ? 'bg-(--primary) text-white' : 'bg-(--color-surface) text-(--color-text-muted)'"
        (click)="loadAllGroundTransports()">
        <lucide-icon name="layout-grid" class="w-4 h-4"></lucide-icon> {{ i18n.translate('common.all') }}
      </button>
      <button class="flex items-center gap-2 px-6 py-3 rounded shadow transition-all duration-300"
        [ngClass]="activeGroundFilter === 'PublicBus' ? 'bg-(--primary) text-white' : 'bg-(--color-surface) text-(--color-text-muted)'"
        (click)="searchByType('PublicBus')">
        <lucide-icon name="bus" class="w-4 h-4"></lucide-icon> {{ i18n.translate('transport.tabs.publicBus') }}
      </button>
      <button class="flex items-center gap-2 px-6 py-3 rounded shadow transition-all duration-300"
        [ngClass]="activeGroundFilter === 'Train' ? 'bg-(--primary) text-white' : 'bg-(--color-surface) text-(--color-text-muted)'"
        (click)="searchByType('Train')">
        <lucide-icon name="train" class="w-4 h-4"></lucide-icon> {{ i18n.translate('transport.tabs.train') }}
      </button>
      <button class="flex items-center gap-2 px-6 py-3 rounded shadow transition-all duration-300"
        [ngClass]="activeGroundFilter === 'UberCareem' ? 'bg-(--primary) text-white' : 'bg-(--color-surface) text-(--color-text-muted)'"
        (click)="searchByType('UberCareem')">
        <lucide-icon name="car" class="w-4 h-4"></lucide-icon> {{ i18n.translate('transport.tabs.uber') }}
      </button>
      <button class="flex items-center gap-2 px-6 py-3 rounded shadow transition-all duration-300"
        [ngClass]="activeGroundFilter === 'PrivateCar' ? 'bg-(--primary) text-white' : 'bg-(--color-surface) text-(--color-text-muted)'"
        (click)="searchByType('PrivateCar')">
        <lucide-icon name="car" class="w-4 h-4"></lucide-icon> {{ i18n.translate('transport.tabs.private') }}
      </button>
    </div>


    <!-- Error Message -->
    <div *ngIf="groundErrorMessage"
      class="text-(--color-error) bg-(--color-surface) border border-(--color-error) p-4 rounded mb-4">{{
      groundErrorMessage }}</div>

    <!-- Services Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div *ngFor="let transport of groundTransports" class="card flex flex-col justify-between">
        <div class="flex items-center gap-4 mb-3">
          <div
            class="w-12 h-12 flex items-center justify-center rounded-full bg-(--color-bg) border border-(--border) text-2xl">
            <span *ngIf="transport.type=='Train'">ğŸš†</span>
            <span *ngIf="transport.type=='UberCareem'||transport.type=='PrivateCar'">ğŸš–</span>
            <span *ngIf="transport.type=='PublicBus'">ğŸš</span>
          </div>
          <div>
            <h3 class="text-lg font-semibold">{{ transport.serviceName }}</h3>
            <div *ngIf="transport.rate" class="text-sm text-(--color-text-muted) mt-1">â­ {{ transport.rate }}</div>
          </div>
        </div>

        <div *ngIf="transport.route || transport.duration" class="mb-3 border-b border-(--border) pb-3">
          <div *ngIf="transport.route">
            <div class="text-xs text-(--color-text-muted) uppercase font-semibold">{{ i18n.translate('transport.route')
              }}</div>
            <div class="text-sm font-medium">{{ transport.route }}</div>
          </div>
          <div *ngIf="transport.duration" class="mt-2">
            <div class="text-xs text-(--color-text-muted) uppercase font-semibold">{{
              i18n.translate('transport.flight.duration') }}</div>
            <div class="text-sm font-medium">{{ transport.duration }}</div>
          </div>
        </div>

        <div>
          <div *ngFor="let amenity of transport.amenities"
            class="flex items-center gap-2 text-sm text-(--color-text-muted) mb-1">
            <lucide-icon name="check-circle" class="w-4 h-4 text-(--primary)"></lucide-icon>
            {{ amenity }}
          </div>
        </div>

        <div class="flex items-center justify-between mt-4 pt-4 border-t border-(--border)">
          <div>
            <div class="text-xs text-(--color-text-muted) uppercase">{{ i18n.translate('common.perPerson') }}</div>
            <div class="text-xl font-bold text-(--primary)">{{ transport.pricePerPerson |
              currency:'SAR':'symbol':'1.0-0' }}</div>
          </div>
          <div>
            <button class="btn-primary" (click)="bookGroundTransport(transport)">{{ i18n.translate('transport.book.now')
              }}</button>
          </div>
        </div>
      </div>
    </div>
  </div>